\section{Computing the maximal resilient subsystem}

Let $\mathscr{S}=(S, \rightarrow, \leq)$ be WSTS and $X \subseteq S$ be an upward-closed set given by its finite minimal basis $B_X$. 

\begin{definition}
We say that $\mathscr{S}=(S, \rightarrow, \leq)$ is $X$-resilient (resp. $(s_0,X)$-resilient) if $S  \xrightarrow{*} X$ (resp. $\post^*(s_0) \xrightarrow{*} X$) is satisfied.  
\end{definition}

We may verify that  $\mathscr{S}=(S, \rightarrow, \leq)$ is $X$-resilient iff  $\mathscr{S}=(S, \rightarrow, \leq)$ is $\pred^*(X)$-resilient. The \emph{maximal $X$-resilient subsystem} of $\mathscr{S}=(S,\rightarrow,\leq)$ is defined as $\mathscr{S}_X=(S,\rightarrow_X,\leq)$ where $\rightarrow_X$ is the largest restriction of $\rightarrow$ that insures that $\mathscr{S}_X$ is $X$-resilient.
\alain{vérifier que la plus grande existe}
Let us remark that given a WSTS $\mathscr{S}=(S, \rightarrow, \leq)$, one may construct many \emph{guard} systems where every transition $s \rightarrow s'$ of $\mathscr{S}$ is guarded by a (monotone) formula $\phi$ defined by the grammar $\phi ::= s \geq u \mid s' \geq u \mid \phi \vee \phi \mid \phi \wedge \phi$ where $u \in S$. Since guards restrict the original runs but don't create new ones, every guarded transition system $\mathscr{S'}$ is a subsystem of $\mathscr{S}$. Since these formula are upward-compatible, the guarded transition systems $\mathscr{S'}=(S, \rightarrow', \leq)$ are still WSTS.
%
For example, VASS allows such guards.
  %	\lor s' \geq x_2  	\lor...	\lor s' \geq x_p$ (facile dans les VASS et modèles habituels).

\begin{theorem}{}
Given an effective WSTS with effective pred-basis and an upward-closed set $X$, the maximal resilient subsystem is a computable WSTS.
\end{theorem}

\begin{proof}
Since $X \subseteq S$ is upward-closed and $\mathscr{S}=(S, \rightarrow, \leq)$ is an effective WSTS with effective pred-basis, we compute the minimal basis of $\pred^*(X)=\{x_1,x_2,...,x_p\}$. 
%
%
Then we add the following guard $s' \geq x_1  	\vee s' \geq x_2  	\vee...	\vee s' \geq x_p$ to every transition $s \rightarrow s'$ of $\mathscr{S}$ and we define  $s \rightarrow' s'$ as $(s' \geq x_1  	\vee s' \geq x_2  	\vee...	\vee s' \geq x_p) \wedge s \rightarrow s'$ ; this insures that the new (guarded) WSTS $\mathscr{S'}=(S, \rightarrow', \leq,s_0)$ is $\pred^*(X)$-resilient and then it is also the maximal resilient sub-WSTS of $\mathscr{S}=(S, \rightarrow, \leq)$.
\end{proof}
%		l'état atteint $s'$ est au dessus des minimaux de $\pred^*(X)$, ainsi par (upward) compatibility on sera toujours capable d'aller dans $X$. 
%
%
%\noindent
%{\bf Vector addition system with states}
%
Let us recall that a {\em vector addition system with states (VASS)} in dimension $d$ ($d$-VASS for short) is a finite $\mathds{Z}^d$-labeled directed graph $V = (Q,T)$, where $Q$ is the set of {\em control-states}, and $T \subseteq Q \times \mathds{Z}^d \times Q$ is the set of {\em control-transitions}. 
% The {\em size} of $V$ is defined as $|V|=|Q|+|T|*d*|log(||T||)$ where $||T||$ denotes the absolue value of the largest number that appears in $T$, i.e. $||T|| = max\{ ||\textbf{z}||: (p,\textbf{z},q) \in T\}$.
%
Subsetquently, $Q \times \N^d$ is the set of configurations of the transition system associated with $V$.
For all configurations $p(\textbf{u}), q(\textbf{v}) \in Q \times \N^d$ and for every control-transition $t = (p, \textbf{z}, q)$ we write $p(\textbf{u}) \xrightarrow{t} q(\textbf{v})$ whenever $\textbf{v} = \textbf{u} + \textbf{z} \geq \textbf{0}$
%
\iffalse \mathieu{Defining it like this makes it a LTS rather than a unlabeled TS - maybe talk about how we can 'forget' the labels to obtain an unlabeled TS ?}
\alain{les VASS ne sont pas vraiment étiquetés, sauf si on veut le faire, car on peut dire que les VASS sont définis à partir d'un nombre fini de control-transitions  $t = (p, \textbf{z}, q)$ générant une infinité de transtions notées $p(\textbf{u}) \xrightarrow{t} q(\textbf{v})$ puisque pour tout s, $p(\textbf{u+s}) \xrightarrow{t} q(\textbf{v+s})$} \fi
When in the context of a $d$-VASS, we denote $0^d$ by $\textbf{0}$.

\noindent

Let  $V$ be a $d$-VASS, $X \subseteq \mathds{N}^d$ be an upward-closed set and $B_X$ its minimal basis: $X=\uparrow B_X$. The number of elements of $min(\pred^*(\uparrow B_X))$ and the size of the minimal elements in $min(\pred^*(X))$ have been studied in
\cite{DBLP:conf/rp/BozzelliG11}: both sizes are bounded by $2^{2^n}$ where $n$ is the size of $V$.

\begin{theorem}{}
Let $V$ be a VASS and $X$ be an upward-closed set. The maximal $X$-resilient subsystem of $V$ is a computable VASS of size $2^{2^n}$ where $n$ is the size of $V$.
\end{theorem}

We may use the previous Theorem with different upward-closed sets $X$. Let us first recall the definition of 4 types of configurations used in \cite{DBLP:journals/acta/ValkJ85}.

\begin{definition}
Let $V = (Q,T)$ be a $d$-VASS, $\hat{T} \subseteq T$, and $m$ a configuration in $Q \times \N^d$.
\begin{itemize}
\item  $m$ is \em{$\hat{T}$-blocked} if no $t \in \hat{T}$ is fireable in $\post^*(m)$.
\item $m$ is \em{dead} if the reachability tree from $m$ is finite.
\item $m$ is \em{bounded} if the reachability set from $m$ is finite.
\item $m$ is \em{$\hat{T}$-continual} if there is an unfinite run from $m$ such that all transitions in $\hat{T}$ appear infinitely often.
\end{itemize}
\end{definition}

These 4 questions are decidable: $m$ is $\hat{T}$-blocked iff the preconditions of each transition in $\hat{T}$ is not coverable from $m$.
$m$ is dead iff $V$ with $m$ as initial configuration terminates. $m$ is bounded iff $V$ with $m$ as initial configuration is bounded.
Hence, the first two problems reduce to coverability which is EXPSPACE. The third problem is also well-known in EXPSPACE. The fourth problem can be decided by analysing circuits in the coverability graph \cite{DBLP:journals/acta/ValkJ85} but it can be also shown in EXPSPACE following techniques exposed in \cite{DBLP:journals/jcss/Demri13}.

Let us consider the following four associated upward-closed sets.

\begin{itemize}
\item  NotBlocked($\hat{T})= \{ m \in Q \times \N^d \mid m$ is not $\hat{T}$-blocked\}.
\item NotDead = $\{ m \in Q \times \N^d \mid m$ is not dead\}.
\item UnBounded = $\{ m \in Q \times \N^d \mid m$ is not bounded\}.
\item Continual($\hat{T}$) = $\{ m \in Q \times \N^d \mid m$ is $\hat{T}$-continual\}.
\end{itemize}

Let $(V,v_0)$ be a VASS with an initial state and $X$ be any of the 4 previous sets. Valk and Jantzen showed that the maximal subsystem of $(V,v_0)$ such that its reachability set $\post^*(V,v_0)$ is included in $X$ is still a VASS $(V_X,v_0)$ that can be constructed with the coverability graph \cite{DBLP:journals/acta/ValkJ85} whose complexity is Ackermanian. Let us remark that the basis of the four upward-closed sets $X$ are computable in $2^{2^n}$, the maximal $X$-resilient VASS of $V$ is also a computable VASS $V_X$ and that $V_X$ is independant of the initial state $v_0$.






\section{Resilience for VASS}




\begin{proposition}
{\sc Bounded resilience} and {\sc $k$-resilience} never hold for vector addition system when $\Safe = \downarrow \Safe$ and $\Bad = \uparrow \Bad$
\end{proposition}


\begin{theorem}{}
Resilience is decidable for VASS when $\Safe$ and $\Bad$ are semilinear sets.
\end{theorem}

\begin{proof}
When asking about {\sc Resilience}, in context, there are no true ``neutral'' configurations.
Indeed, from a VASS $V$, $\Safe$ and $\Bad$ semilinear, one can build VASS $V'$, $\Safe'$ semilinear, and $\Bad'$ complement of $\Safe'$ such that {\sc Resilience} holds for
$V$, $\Safe$ and $\Bad$ if and only if {\sc Resilience} holds for
$V'$, $\Safe'$ and $\Bad'$. For the construction, $V'$ will have two copies of the control states of $V$; $Q_{A}$ and $Q_{B}$, and will have two other VASS running in parallel checking whether or not the current configuration belong to $\Safe$ resp. $\Bad$. 
From a configuration with state in $Q_{A}$ you go to $Q_B$ when you are in a $\Bad$ place
and from a configuration with state in $Q_{B}$ you go to $Q_{A}$ when you are in a $\Safe$ place.
$\Safe'$ is $Q_A \times \N^d$ and $\Bad'$ is $Q_B \times N^d$.

Without loss of generality hence let us consider only the case when $\Safe$ is semilinear
and $\Bad = S \setminus \Safe$ is semilinear too.
{\sc Resilience} asks whether $\Bad \subseteq \pred^*(\Safe)$.
We have $\post^*(\Bad) \setminus \Safe = \Bad$ by extension of $S \setminus \Safe = \Bad$.
Thus $\post^*(\Bad) = \Bad \cup (\Safe \cap \post^*(\Bad))$. Since $(\Safe \cap \post^*(\Bad)) \subseteq \pred^*(\Safe)$, we have
\[\post^*(\Bad) \subseteq \pred^*(\Safe) \quad iff \quad \Bad \subseteq \pred^*(\Safe).\]
Since it is decidable whether $\post^*(\Bad) \subseteq \pred^*(\Safe)$ when 
$\Bad$ and $\Safe$ are both semilinear~\cite{DBLP:journals/corr/abs-2207-02697}, 
{\sc Resilience} is decidable.
\end{proof}

Resilience is also decidable for other class of counter machines for which the reachability relation can be expressed in a decidable logics. Recall that lossy counter machines \cite{DBLP:conf/rp/Schnoebelen10} are counter machines that may loose tokens in each control-state.

\begin{theorem}{}
Resilience is decidable for lossy counter machines when $\Safe$ and $\Bad$ are semilinear sets.
\end{theorem}

\begin{proof}
We deduce from Theorem 3.6 in \cite{DBLP:conf/rp/Schnoebelen10} that $\pred^*(\Safe)$ is a computable semilinear set if $\Safe$ is semilinear. Hence since the inclusion between two semilinear sets is decidable, we deduce that $\Bad \subseteq \pred^*(\Safe)$ is decidable if $\Bad$ is semilinear.
\end{proof}

Integer VASS or $\mathbb{Z}-$VASS \cite{DBLP:conf/rp/HaaseH14} are VASS that are allowed to take values from the integers.

\begin{theorem}{}
Resilience is decidable for integer VASS when $\Safe$ and $\Bad$ are semilinear sets.
\end{theorem}

\begin{proof}
The reachability relation of integer $d$-VASS is definable by a sentence in Presburger in $\mathbb{Z}^d$ hence	$\Bad \subseteq \pred^*(\Safe)$ is decidable when $\Safe$ and $\Bad$ are semilinear sets.
% For Z-VAS we observe that we are asking for inclusion between linear sets. 
% Again let us without loss of generality hence let us consider only the case when $\Safe$ is semilinear and $\Bad = S \setminus \Safe$ is semilinear too.
\mathieu{Expliciter davantage la preuve ? $\pred^*(\Safe)$ semilinéaire car définissable en Presburger ? Puis inclusion de semilinéaires décidables.}
\end{proof}

Continuous VASS \cite{DBLP:journals/tocl/BlondinFHH17} are a relaxation of classical discrete VASS in which transitions can be fired a fractional number of times, and consequently counters may contain a fractional number of tokens.

\begin{theorem}{}
Resilience is decidable for continuous VASS when $\Safe$ and $\Bad$ are definable in the existential theory of
the rationals with addition and order.
\end{theorem}

\begin{proof}
The reachability relation of continuous VASS is definable by a sentence of linear size in the existential theory of
the rationals with addition and order whose complexity is EXPSPACE \cite{DBLP:journals/tocl/BlondinFHH17}. Hence, $\Bad \subseteq \pred^*(\Safe)$ is also in EXPSPACE. 
%			\alain{and may be in coNP-complete. Recall that reachability is P-complete for continuous VASS}
\end{proof}

\mathieu{Tableau résumé de la situation pour les VASS}

\begin{center}
\begin{tabular}{ | l | c | c | c | r |}
\hline   \Safe~\Bad 
		& $\uparrow$~ $\downarrow$~ 
		 & $\downarrow$~ $\uparrow$~ 

 \\ \hline
   RP  
   	& Decidable (Thm~\ref{down-up})  
   		 & ??

    \\ \hline
   BRP  
   &  Decidable (Thm~\ref{down-up}) 
   		 & Decidable  ?

    \\ \hline
      kRP  
      & Decidable (Thm~\ref{down-up}) 
      		& Decidable ?

       \\ \hline
   sRP  
   	& Decidable (Thm~\ref{post srp})
   		 & ??


    \\ \hline
   BsRP  
   &  Decidable (Thm~\ref{ref ozkan})
   		 & ?? 

    \\ \hline
      ksRP   
      & Decidable (Thm~\ref{ref ozkan})
      		& ?? 

       \\ \hline

\end{tabular}
\end{center}

\begin{proposition}
{\sc Bounded resilience} and {\sc $k$-resilience} never hold for vector addition system when $\Safe = \downarrow \Safe$ and $\Bad = \uparrow \Bad$
\end{proposition}


\begin{proof}
Consider a given $k \in \N$,
 $\Bad \subseteq \N^d$ upward-closed and $\Safe \subseteq \N^d$ downward-closed, and
consider a given vector addition system $V$.
Let us call $c_{\max}$ the maximal absolute value of a constant appearing in a coordinate of a transition of $V$.

The set $\Bad$ admits a finite basis $B_\Bad$.
Consider $\textbf{v}_{\Bad}$ obtained by summing all members of the basis of $\Bad$ and then consider 
$\textbf{u}_k = \textbf{v}_{\Bad} + (k+1) \cdot (c_{\max}, c_{\max}, \ldots, c_{\max})$.

All configurations reachable from $\textbf{u}_k$ in $k$ or less steps are above $ \textbf{v}_{\Bad} $
and thus, are in $\Bad$, by upward-closedness.

Hence  $\Safe$ is not reachable from $\textbf{u}_k$ in $k$ or less steps  and {$k$-resilience} does not hold.
Since the reasoning hold for all $k \in \N$, {\sc Bounded-resilience} does not hold either.
\end{proof}

\iffalse
\mathieu{
resilience never hold in the case of VAS. 
What happens when you add states ? \\
So you consider for instance $q_0(u_k)$ instead of just $u_k$. \\
Everything reachable from $q_0(u_k)$ is still of the form $q(u)$ with u greater than $v_{\Bad}$
(we'd have $v_{\Bad}$ sum of the coordinate of the elements from the basis of $\Bad$ when not considering states).
So now, let us fix some state $q$.
Either there is an element of the basis of $\Bad$ with state $q$.
Then $q(u)$ is necessarily in $\Bad$ (If this hold for all $q \in Q$, then again $k$-resilience does not hold).
Either there is none.
If there is none, then $q(\omega)$ is in the complement of $\Bad$, i.e. $\Safe$.
Then, of course there are probably other elements in $\Safe$ but from
the perspective of $\Bad$ and the extremely high elements $q_i(u_k)$  these ‘smaller’ elements are all but unreachable. 
And the question becomes rather `can we reach $q(\omega)$ from every element of $\Bad$ save from maybe the few smaller ones ?’
Since $q(\omega)$ here is upward-closed this is decidable i.e. it is asking coverability questions. 
It’s not 100\% the question «asking, for every element in the basis of $\Bad$, whether or not $q(0)$ is coverable from it», since you could have, for smaller elements in $\Bad$, other elements of $\Safe$ you can reach, but it seem close.
This would lead to a decision scheme.
Need to write this more formally/properly.}
\fi

\begin{theorem}
{\sc $k$-resilience }  and {\sc Bounded resilience} in VASS when $\Bad = \uparrow \Bad$ and $\Safe = S \setminus \Bad$ are decidable%, and moreover {\sc $k$-resilience } is in $\EXPSPACE$
.
\end{theorem}


\begin{proof}
Let $V$ be a given $d$-VASS and consider a given $k \in \N$.
Consider $\Bad \subseteq Q \times \N^d$ upward-closed and 
% $\Safe \subseteq Q \times \N^d$
$\Safe = S \setminus \Bad$
 downward-closed.
Let us call $c_{\max}$ the maximal absolute value of a constant appearing in a coordinate of a transition.

The set $\Bad$ admits a finite basis 
$B_\Bad = \{ q_{i_1}(\textbf{v}_{i_1}), q_{i_2}(\textbf{v}_{i_2}), \ldots,
q_{i_m}(\textbf{v}_{i_m}) \}$.
Consider $\textbf{v}_{\Bad} = \Sigma_{1 \leq j \leq m} \textbf{v}_{i_j}$,
and then consider 
$\textbf{u}_k = \textbf{v}_{\Bad} + (k+1) \cdot (c_{\max}, c_{\max}, \ldots, c_{\max})$.
For all $p \in Q$, all configurations reachable from $p(\textbf{u}_k)$ in $k$ or less steps are 
of the form $q(\textbf{v})$ with $ \textbf{v} > \textbf{v}_{\Bad}$.

For all $q \in Q$, either there is an element of the basis of $\Bad$ with state $q$ \----
then $q(\textbf{v})$ with $\textbf{v} > \textbf{v}_{\Bad}$ is necessarily in $\Bad$ by upward closure; if this hold for all $q \in Q$, then $k$-resilience does not hold \---- either there is none. If there is none, then 
% $q'(\omega)$
$\uparrow q(\textbf{0})$
 is in the complement of $\Bad$, i.e. $\Safe$.

Let us assume from now on 
% $q_{j_1}(\omega), q_{j_2}(\omega), \ldots q_{j_\ell}(\omega)$ are
 $\uparrow q_{j_1}(\textbf{0}), \uparrow q_{j_2}(\textbf{0}), \ldots \uparrow q_{j_\ell}(\textbf{0})$ are
all subsets of $\Safe$ and that their union contain all upward-closed subsets of $\Safe$.
Because these subsets are upward-closed, we can compute a basis of
% $\pred^{\leq k}(q_{j_1}(\omega))$, $\pred^{\leq k}(q_{j_2}(\omega))$, \ldots
% $\pred^{\leq k}(q_{j_\ell}(\omega))$.
$\pred^{\leq k}(\uparrow q_{j_1}(\textbf{0}))$, $\pred^{\leq k}(\uparrow q_{j_2}(\textbf{0}))$, \ldots
$\pred^{\leq k}(\uparrow q_{j_\ell}(\textbf{0}))$.


We now consider the set 
% $\Bad \setminus (\pred^{\leq k}(q_{j_1}(\omega)) \cup \ldots \pred^{\leq k}(q_{j_\ell}(\omega)) )$.
$\Bad \setminus (\pred^{\leq k}(\uparrow q_{j_1}(\textbf{0})) \cup \ldots \cup \pred^{\leq k}(\uparrow q_{j_\ell}(\textbf{0})) )$.
% \mathieu{Is it actually possible to check whether or not it is finite ?}
% If it is finite then w
We inductively check for any element in the set whether or not it is possible to reach from it the set $\Safe$ in $k$ or less steps.
If the set is finite then we stop the procedure once we have checked found a witness that $k$-resilience does not hold or once we have checked for every element, whichever comes first.
If it is infinite then
$k$-resilience does not hold 
and we eventually find a witness that $k$-resilience does not hold.
Indeed, 
if
$\Bad \setminus (\pred^{\leq k}(\uparrow q_{j_1}(\textbf{0})) \cup \ldots \cup \pred^{\leq k}(\uparrow q_{j_\ell}(\textbf{0})) )$
is
infinite
then
there exists an element of the form $q(\textbf{u} )$
with $\textbf{u} > \textbf{v}_{\Bad} + (k+1) \cdot (c_{\max}, \ldots, c_{\max})$ 
that is in $\Bad$ but not in any of the $\pred^{\leq k}(\uparrow q_{j_i}(\textbf{0}))$,
and hence from which it is not possible at all to reach
$\Safe$ in $k$ or less steps. This also means that, even in the case where $\Bad \setminus (\pred^{\leq k}(\uparrow q_{j_1}(\textbf{0})) \cup \ldots \cup \pred^{\leq k}(\uparrow q_{j_\ell}(\textbf{0})) )$ is finite, we only need to check reachability of $\Safe$ in $k$ or less steps for the elements with vectorial component at most
$ \textbf{v}_{\Bad} + (k+1) \cdot (c_{\max}, \ldots, c_{\max})$. Binding the search space
thus leads to an $\EXPSPACE$ upper bound for {\sc $k$-resilience }.


In order to deal with {\sc Bounded resilience} now, remark that there exists some $k_0 \in \N$ for which
and hence
$\Bad \setminus (\pred^{\leq k_0}(\uparrow q_{j_1}(\textbf{0}))\cup \ldots \cup \pred^{\leq k_0}(\uparrow q_{j_\ell}(\textbf{0}))= 
\Bad \setminus (\pred^{*}(\uparrow q_{j_1}(\textbf{0})) \cup \ldots \pred^{*}(\uparrow q_{j_\ell}(\textbf{0})) )$.
We start the decision procedure by checking {\sc $k$-resilience} from $0$ until $k_0$.

From $k_0$ onwards,
$\Bad \setminus (\pred^{\leq k}(\uparrow q_{j_1}(\textbf{0}))\cup \ldots \cup \pred^{\leq k}(\uparrow q_{j_\ell}(\textbf{0}))= 
\Bad \setminus (\pred^{*}(\uparrow q_{j_1}(\textbf{0})) \cup \ldots \pred^{*}(\uparrow q_{j_\ell}(\textbf{0})) )$
is stationnary. 
If the set is finite then we stop the procedure once we have checked for every element
whether it is possible to reach $\Safe$ from it.
If it is possible to reach $\Safe$ from every element then {\sc $k_m$-resilience}
hold
for $k_m = \max(k_0, k_{\pi})$ with 
$k_{\pi}$ the maximum of the length of the paths from 
$\Bad \setminus (\pred^{\leq k_0}(\uparrow q_{j_1}(\textbf{0}))\cup \ldots \cup \pred^{\leq k_0}(\uparrow q_{j_\ell}(\textbf{0}))$ to $\Safe$.
If it is infinite then
for every $k \in \N$,
$k$-resilience does not hold, 
and we eventually find a witness that $k$-resilience does not hold.
Indeed, 
if
$\Bad \setminus (\pred^{*}(\uparrow q_{j_1}(\textbf{0})) \cup \ldots \cup \pred^{*}(\uparrow q_{j_\ell}(\textbf{0})) )$
is
infinite
then
there exists an element of the form $q(\textbf{u} )$
with $\textbf{u} > \textbf{v}_{\Bad} + (k+1) \cdot (c_{\max}, \ldots, c_{\max})$ 
that is in $\Bad$ but not in any of the $\pred^{\leq k}(\uparrow q_{j_i}(\textbf{0}))$,
and hence from which it is not possible at all to reach
$\Safe$ in $k$ or less steps.
\end{proof}





\mathieu{
VASS donc la base de $\uparrow post^*(s_0)$ est calculable. 
Intersection de $\Bad$ et $\uparrow \post^*(s_0)$ est upward-closed donc ça se fait
					de décider si c'est  $\subseteq \pred^{\leq k}(\Safe)$
	(re: $k$-résilience décidable voir Prop. 34)
Problème: on pourrait avoir $\uparrow post^*(s_0) \neq  post^*(s_0)$.
Si $ \Bad \cap \uparrow \post^*(s_0) \subseteq  \pred^{\leq k}(\Safe)$ alors on a aussi
$ \Bad \cap  \post^*(s_0) \subseteq  \pred^{\leq k}(\Safe)$.
Si non, alors
notre procédure décisionnelle pour vérifier
ça
donne un témoin.
Le témoin, on peut vérifier si il est bien dans $\post^*(s_0)$
(c'est juste la question de est-ce que on peut l'atteindre depuis $s_0$
et l'accessibilité est décidable).
Si il est effectivement dans $\post^*(s_0)$ alors c'est bon on a aussi un contre exemple
qui prouve que
$ \Bad \cap  \post^*(s_0) \nsubseteq  \pred^{\leq k}(\Safe)$.
Si le témoin n'est pas dans $\post^*(s_0) \ldots$ alors
$\ldots$
j'imagine on peut reprendre la procédure décisionnelle sur 
$ \Bad \cap \uparrow \post^*(s_0)$
mais en excluant ce premier témoin,
et ou bien on a que c'est bon si on enlève ce témoins alors on a bien 
$\subseteq \pred^{\leq k}(\Safe)$
ou bien ... on obtiens un nouveau témoin ... pour lui aussi on peut
vérifier si il est effectivement dans $\post^*(s_0)$, et ainsi de suite.
Si jamais la $k$-résilience n'est pas vérifiée, on vas bien finir par
trouver un témoin que ça n'est pas vérifiée.
Si jamais la $k$-résilience est vérifiée par contre ...
$ \Bad \cap  \post^*(s_0)  \setminus \pred^{\leq k}(\uparrow q_{j_1}(\textbf{0}))$, $\pred^{\leq k}(\uparrow q_{j_2}(\textbf{0}))$, \ldots
$\pred^{\leq k}(\uparrow q_{j_\ell}(\textbf{0}))$
doit être fini, on a dit.
Est-ce qu'il y aurais un moyen de calculer ça plutôt ?
Par exemple,
on regarde
$ \Bad \cap \uparrow \post^*(s_0)  \setminus \pred^{\leq k}(\uparrow q_{j_1}(\textbf{0}))$, $\pred^{\leq k}(\uparrow q_{j_2}(\textbf{0}))$, \ldots
$\pred^{\leq k}(\uparrow q_{j_\ell}(\textbf{0}))$,
comme on a le $\uparrow$ 
devant $\uparrow \post^*(s_0)$
alors
deux choses se produisent,
d'abords les "trous" entre les éléments de $ \post^*(s_0)$ sont comblés.
Sauf que si un "trou" est un contre exemple et qu'on a qu'un nombre fini de
trou alors "on voit bien" que c'est un trou en testant que
ça appartiens ou non à $ \post^*(s_0)$ et "ça va" on peut s'en débarasser.
L'autre chose qui se produit, c'est que on a les droites qui vont vers plus l'infini...
Ça c'est plus difficile à gèrer parce que si
il y a qu'un nombre fini d'éléments dans $ \Bad \cap \uparrow \post^*(s_0)  \setminus \pred^{\leq k}(\uparrow q_{j_1}(\textbf{0}))$, $\pred^{\leq k}(\uparrow q_{j_2}(\textbf{0}))$, \ldots
$\pred^{\leq k}(\uparrow q_{j_\ell}(\textbf{0}))$
et pas dans
$ \Bad \cap  \post^*(s_0)  \setminus \pred^{\leq k}(\uparrow q_{j_1}(\textbf{0}))$, $\pred^{\leq k}(\uparrow q_{j_2}(\textbf{0}))$, \ldots
$\pred^{\leq k}(\uparrow q_{j_\ell}(\textbf{0}))$
ça se fait,
mais si il y a un nombre infini d'éléments dans
$ \Bad \cap \uparrow \post^*(s_0)  \setminus \pred^{\leq k}(\uparrow q_{j_1}(\textbf{0}))$, $\pred^{\leq k}(\uparrow q_{j_2}(\textbf{0}))$, \ldots
$\pred^{\leq k}(\uparrow q_{j_\ell}(\textbf{0}))$
potentiellement pas dans le plus petit,
alors c'est plus compliqué de faire notre procédure décisionnelle.
Il nous faudrait pouvoir décider si $\post^*(s_0)$ est fini ou non.
Décider si $\post^*(s_0)$ est borné ou non.
Est-ce que ça peut se réduire à un submarking problem ?
Il faudrait prendre le complémentaire peut-être ...}




%
\iffalse
%
\subsection{Timed Automata}

\textcolor{red}{Should be defined in a later 'application section' once we start writing any proof, for now I leave it there} 

\renewcommand{\A}{\mathcal{A}}
\newcommand{\B}{\mathcal{B}}
\renewcommand{\C}{\mathcal{C}}
\newcommand{\Const}{\mathsf{Consts}}
\newcommand{\Conf}{\mathsf{Conf}}
\newcommand{\guards}{{\textsc{Guards}}}

% \subsubsection{Guards, Clocks}

A {\em guard} over a finite set of clocks $\Omega$ 
is a comparison of the form
$\omega \bowtie c$, where $ \omega \in \Omega$, $c \in \N$,
and $\bowtie\in\{<,\leq,=,\geq,>\}$.
%
We denote by $\guards(\Omega)$ the {\em set of guards} over the set of 
clocks $\Omega$.
The {\em size} %$|g|$
 of a guard 
$g=\omega \bowtie c$ is defined as %:
$|g|=\log(c)$.
A {\em clock valuation} is a function from $\Omega$ to $\N$;
we write $\vec{0}$ to denote the clock valuation $\omega \mapsto 0$
whenever the set $\Omega$ is clear from the context.
For each clock valuation $v$ and each $t\in\N$ we denote
by $v+t$ the clock valuation $\omega \mapsto v(\omega)+t$.
%
For each guard $g=\omega \bowtie c$ with $c\in\N$,
we write $v\models g$ if $v(\omega)\bowtie c$.

\iffalse
We define an {\em empty guard} $g_\epsilon$ over a non-empty finite set of clocks
$\Omega$ and to be of the form $\omega \geq 0$ for some 
$\omega \in \Omega$. In particular, we
defined $g_\epsilon$ such that for all $v \in \N^\Omega$ 
we have
$v \models g_\epsilon$, hence $g_\epsilon$ can be used as a guard that is always true. 
\fi

% \subsubsection{Timed automata}


A timed automaton is a finite automaton extended with a finite set of clocks $\Omega$ that all progress at the same rate and that can individually be reset to zero. Moreover, every transition is labeled by a guard over 
$\Omega$  and by a set of clocks to be reset. \\

\par\noindent\ignorespacesafterend
Formally, a {\em timed automaton} ({\em TA} for short) is a tuple
$\A=(Q,\Omega,R,q_{init},F)$, where
\begin{samepage}
\begin{itemize}
	\item $Q$ is a non-empty finite {\em set of states}, 
	\item $\Omega$ is a non-empty finite {\em set of clocks},
	\item $R \subseteq Q\times\G(\Omega)\times \mathscr{P}(\Omega) \times Q$
	is a finite {\em set of  rules},
	\item $q_{init}\in Q$ is an {\em initial  state}, and 
	\item $F\subseteq Q$ is a {\em set of final states}.
\end{itemize}
\end{samepage}

\par\noindent\ignorespacesafterend
We also refer to $\A$ as an $n$-TA if $|\Omega| = n$. 
The {\em size} of $\A$ is defined as%:
\[
|\A| \ = \ |Q|+|\Omega|+|R|+\sum_{(q,g,U,q')\in R}|g|.
\]
Let 
$\Const(\A) = \{ c\in\N \mid \exists(q,g,U,q')\in R, \ \exists \omega \in \Omega, \bowtie\in\{<,\leq,=,\geq,>\} : g = \omega \bowtie c \}$ denote the 
set of constants that appear in the guards of the rules of $\A$.

By $\Conf(\A)=Q\times\N^\Omega$ we denote the set of
{\em configurations} of $\A$. 
%We prefer however to denote a configuration in $\Const(\A)$ by $q(v)$ instead of $(q,v)$.\\
We prefer however to abbreviate a configuration	%	 in $\Conf(\A)$	
$(q,v)$ by $q(v)$.


\begin{samepage}
%\begin{definition}
A TA $\A=(Q,\Omega,R,q_{init},F)$ induces the labeled transition system 
$T_{\A} =  (\Conf(\A), \Lambda_{\A}, \rightarrow_{\A})$
where $ \Lambda_{\A} = R \times \N $
and 
where $ \rightarrow_{\A}$ is defined such that, 
for all $(\delta,t)\in R\times\N$ with  	$\delta = (q,g,U,q')\in R$,
for all $q(v), q'(v') \in \Conf(\A)$,
$q(v)\xrightarrow{\delta,t}_{\A} q'(v')$ if
	$v+t\models g$, 
	 $v'(u)=0$ for all $u \in U$ and $v'(\omega)=v(\omega)+t$ for all 
	$\omega \in \Omega \setminus U$.
%\end{definition}
\end{samepage}

A {\em run} from $q_0(v_0)$ to $q_n(v_n)$ in $\A$ is a path in the transition system $T_{\A}$, that is,
a sequence 
$\pi = q_0(v_0)\xrightarrow{\delta_1,t_1}_{\A}q_1(v_1)\cdots\xrightarrow{\delta_n,t_n}_{\A}q_n(v_n)$;
it is called {\em reset-free} if for all $i \in \{1,\ldots,n\}$,
 $\delta_i = (g_i,\emptyset)$ for some guard $g_i$.


We say $\pi$ is {\em accepting} if $q_0(v_0) = q_{init}(\vec{0})$ and $q_n \in F$. 
\iffalse
We say {\em reachability holds} for the TA $\A$ 
if there exists an accepting run. %
% if there is a run in $\A$ from $q_{init}(\vec{0})$   to some configuration $q(v)$ for some $q\in F$, and $v\in\N^\Omega$.
%We refer to Figure~\ref{example pta} for an instance of a PTA for which reachability holds.
\fi


It is worth mentioning that there are further modes of time valuations and guards which exist in the literature, we refer
to \cite{Andre19} for a recent overview. 
%
% \mh{Comment on difference between continuous and discrete time}
Notably, we consider in this article only the case of timed automata over discrete time. It is worth mentioning that in
the case of timed automata over continuous time (i.e. with clocks having values in $\R_{\geq 0}$),
% However, for parametric timed automata with closed (i.e., non-strict) clock constraints and parameters restricted to ranging over integers, 1 standard digitisation techniques apply [HMP92, OW03], reducing the reachability problem over dense time to discrete (integer) time.
techniques~\cite{HenzingerMP92,OuaknineW03} exist for reducing the reachability problem to discrete time in the case of closed (i.e. non-strict) clock constraints ranging over integers. \\




\problemx{TA $k$-resilience problem}
{A state $q$ of a TA $(Q, X, \Delta)$, a set $SAFE \subseteq Q$, a set $BAD \subseteq Q$.}
{$\forall q' \in BAD \forall v,v' \in \N^X ~ (q(v) \rightarrow^* q'(v')) \implies \exists q'' \in SAFE \exists v'' \in \N^X ~ q'(v') \rightarrow^{\leq k} q''(v'')$ ?\newline}


Analogously, we formulate the bounded resilience problem for WSTSs.


\problemx{TA bounded resilience problem}
{A state $q$ of a TA $(Q, X, \Delta)$, a set $SAFE \subseteq Q$, a set $BAD \subseteq Q$.}
{$\exists k \geq 0 ~ \forall q' \in BAD \forall v,v' \in \N^X ~ (q(v) \rightarrow^* q'(v')) \implies \exists q'' \in SAFE \exists v'' \in \N^X ~ q'(v') \rightarrow^{\leq k} q''(v'')$ ?\newline}

\textcolor{red}{I think there can be a discussion to be had here about how to quantify on the clock valuations}

\textcolor{red}{Here one thing that could be interesting to try to formalize is: how to enforce that the time that passes is less than $k$, rather than the number of transitions. This is tricky to deal with I find but it should be more doable if for instance we use one counter automata, where the counter effect of the sequence can be quantified more explicitly I suppose ?
But here you could also use a kinda special clock $x$ that is reset when you enter $BAD$ and is not reset between a state in $BAD$ and a state in $SAFE$, you could check that $x < k$.}

\textcolor{red}{... I guess if you use $0/1$-TA then the problems become closer one to another ? Also of note is that $0/1$-TA induces transition systems with bounded branching, so I guess it may be interesting to investigate these first ?}

A {\em $0/1$ timed automaton } ({\em $0/1$-TA} for short) is a tuple
\[
\B=(Q,X, \Delta_0, \Delta_1, q_{init}, F),
\]
\par\noindent\ignorespacesafterend
 where
$\B_i=(Q,X, R_i, q_{init}, F)$ is a TA for all $i \in \{0,1\}$.
For simplicity we define its {\em size}
as $|\B|=|\B_0|+|\B_1|$.
We analogously denote the constants of $\B$ 
by $\Const(\B)$ and its configurations by  $\Conf(\B)$.

\begin{samepage}
%\begin{definition}
A $0/1$ timed automaton $\B=(Q,X,R_0,R_1,q_{init},F)$ 
induces the labeled transition system 
$T_{\B} = (\Conf(\B), \lambda_{\B}, \rightarrow_{\B}) $
where $ \lambda_{\B} = (R_0 \cup R_1) \times \{ 0,1\}$
	and where $ \rightarrow_{\B}$
	is defined such that
	for all $q(z), q'(z') \in \Conf(\B)$, 
	for all $(\delta,i) \in \lambda_{\B}$
	with $\delta  = (q,g,U,q')\in R_i$
	$q(v)\xrightarrow{\delta,i}_{\B} q'(v')$ if
	$v+i \models g$, 
	$v'(u)=0$ for all $u \in U$ and $v'(\omega)=v(\omega)+ i$ for all $\omega \in \Omega
	\setminus U$. 
%\end{definition}
\end{samepage}



As expected, we write $q(v)\xrightarrow{\delta,i}_{\B}q'(v')$ if 
$q(v)\xrightarrow{\delta,i}_{\B}q'(v')$ for some 
$i\in\{0,1\}$, and some $\delta \in R_i$.




\subsection{One-Counter Automata}

\textcolor{red}{Should be defined in a later 'application section' once we start writing any proof, for now I leave it there} 


\problemx{OCA $k$-resilience problem}
{A state $q$ of a OCA $(Q, \Delta)$, a set $SAFE \subseteq Q$, a set $BAD \subseteq Q$.}
{$\forall q' \in BAD \forall n,n' \in \N ~ (q(n) \rightarrow^* q'(n')) \implies \exists q'' \in SAFE \exists n'' \in \N ~ q'(n') \rightarrow^{\leq k} q''(n'')$ ?\newline}



\problemx{OCA bounded resilience problem}
{A state $q$ of a OCA $(Q, \Delta)$, a set $SAFE \subseteq Q$, a set $BAD \subseteq Q$.}
{$\exists k \geq 0 ~ \forall q' \in BAD \forall n,n' \in \N ~ (q(n) \rightarrow^* q'(n')) \implies \exists q'' \in SAFE \exists n'' \in \N ~ q'(n') \rightarrow^{\leq k} q''(n'')$ ?\newline}

%
\fi
%

\section{conclusion}

We will analyse in detail the complexities of the different resilience. resilience for other computable models like stack automata,...

\alain{trouver les \Bad~ et \Safe~ maximum tels que S est resilient. est-ce vrai que si S est $(B_i,D_i)$-resilient alors S est $(\cap, \cup B_i,D_i)$-resilient ?}
%
\alain{on peut penser à des ensembles $\Bad$ definis dans une logique booleennne sur les clos par le bas, haut, +...}


%
%
%\subsection{Vector Addition System with States or PN}
%
%\textcolor{red}{Should be defined in a later 'application section' once we start writing any proof, for now I leave it there} 
%



