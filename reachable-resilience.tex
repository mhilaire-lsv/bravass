



\section{State resilience}


Resilience is a strong property since it implies that from every element of $\Bad$ there must exist a path to $\Safe$. But, when one considers a system with an initial state $s_0$, it could be sufficient to ask that only from $\Bad \cap post^*(s_0)$, there must exist a path to $\Safe$. 
%
%			However, this condition seems more difficult since one also must decide whether a state $s \in \Bad$ is reachable from $s_0$.
%
%\problemx{(I,J)-$k$-resilience problem for WSTS}
%{A state $s$ of a WSTS $(S,\rightarrow, \leq)$, an effective set $I$ (with a given basis), a set $J$.}
%{$\forall s' \in J ~ (s \rightarrow^* s') \implies \exists s'' \in I ~ s' \rightarrow^{\leq k} s''$ ?\newline}
%
%\problemx{general $k$-resilience problem for WSTS}
%{A state $s$ of a WSTS $(S,\rightarrow, \leq)$, an effective set $I$ (with a given basis).}
%{$\forall s'  ~ (s \rightarrow^* s') \implies \exists s'' \in I ~ s' \rightarrow^{\leq k} s''$ ?\newline}

%		Again, we first consider the case where the recovery time is bounded by a $k \in \N$.

The three previous problems become:


\problemx{State-resilience problem (SRP)}
{A transition system $\mathscr{S}=(S,\rightarrow)$, $s \in S$ and two sets $\Safe, \Bad \subseteq S$.}
% 		an upward-closed set $\Safe$ with a given basis, a decidable downward-closed set $\Bad$.}
% 		{$ ~ \forall s' \in \Bad, ~ s \rightarrow^* s' \implies \exists s'' \in \Safe, ~ s' \rightarrow^{*} s''$ ?\newline}
{$\Bad \cap \post^*(s_0)  \rightarrow^{*} \Safe $ ? \newline}


\problemx{$k$-state-resilience problem (kSRP)}
{A transition system $\mathscr{S}=(S,\rightarrow)$, $s \in S$ and two sets $\Safe, \Bad \subseteq S$.}
{ $\Bad \cap \post^*(s) \longrightarrow^{\leq k} \Safe$ ?  \newline}
%

\problemx{bounded-state-resilience problem (BSRP)}
{A transition system $\mathscr{S}=(S,\rightarrow)$, $s \in S$ and two sets $\Safe, \Bad \subseteq S$.}
%{$\exists k \geq 0 ~ \forall s' \in D ~ s \rightarrow^* s' \implies \exists s'' \in U ~ s' \rightarrow^{\leq k} s''$ ?\newline}
{$\exists k \geq 0$ such that $\mathscr{S}$ is $k$-state-resilient. ?\newline}


%\textcolor{blue}{
%justification des definitions: si on enlève la condition  an upward-closed set $U$ (extended resilience $U$ qq) reachability reduces to resilience (avec $U=\{x\}$ donc indecidable pour les modèles à reachability indécidable.
%}



Since these problems are undecidable for general infinite-state transition systems, we restrict our study to WSTS.

As in the Section~3, we study decidability results for different pairs of sets $\Safe$ and $\Bad$ downard closed and upward closed.


\subsection{Case: $\Safe = \uparrow \Safe$ and $\Bad = \downarrow \Bad$}

\mathieu{Ici on s'intéresse seulement aux cas $\uparrow \downarrow$ et $\downarrow \uparrow$.}

Let us recall a result about state-resilience (called resilience in \cite{DBLP:conf/gg/Ozkan22,DBLP:journals/corr/abs-2108-00889}).

\begin{theorem}\cite{DBLP:conf/gg/Ozkan22,DBLP:journals/corr/abs-2108-00889}
{\sc bounded-state-resilience} and {\sc $k$-state-resilience} are decidable for WSTS $S$ with strong upward compatibility and such that $\uparrow \post^*(s)$ is computable for $s \in S$.
\end{theorem}

We may immediately generalyse this last result by strengthening to \emph{unbounded} state-resilience. The proof is essentially the same than the previous one.

\begin{corollary}\label{postcomputable}
{\sc state-resilience} is decidable for WSTS with strong upward compatibility and such that $\uparrow \post^*(s)$ is computable for $s \in S$.
\end{corollary}

\begin{proof}
%From Fact~\ref{stop condition},
Since $\mathscr{S}$ is a WSTS there exists $n_0 \in \N$ such that
$\pred^*(\Safe) =  \pred^{\leq n_0}(\Safe)$. We can compute this $n_0$ by iteratively computing 
%\alain{mauvaises notations: $k, k_m, Safe^k,...$ n'a aucun sens...}
$\pred^{\leq n+1}(\Safe)$ from $\pred^{\leq n}(\Safe)$, checking 
$\pred^{\leq n+1}(\Safe) = \pred^{\leq n}(\Safe)$, 
returning $n$ if that is the case.
Then, because $n_0$-state-resilience is decidable, 
checking $\uparrow post^*(s) \cap \Bad \subseteq \pred^{\leq n}(\Safe) = \pred^*(\Safe)$ is,
and state-resilience is decidable.
\end{proof}

\iffalse
\alain{definir downward reachability problem.....
downward-closed problem given a state $s$ of a WSTS
% in the regarded class 
with strong upward compatibility 
and a decidable downward-closed set $D$, it can be decided whether $\exists s' \in D ~ s \to^* s'$. }
\fi


The computability of $\uparrow \post^*(s)$ seems a strong hypothesis. What are the WSTS for which $\uparrow \post^*(s)$ is computable for $s \in S$ ?
Ozkan \cite{DBLP:conf/gg/Ozkan22} argues that it is precisely the WSTS for which the following problem is decidable.

\problemx{Downward reachability problem}
{A transition system $\mathscr{S}=(S,\rightarrow)$, $s \in S$ and a downward-closed set $D
\subseteq S$.}
{$\exists s' \in D ~ s \to^* s'$? \newline}



%\"Ozkan
\begin{proposition}[Proposition 1 in \cite{DBLP:conf/gg/Ozkan22}]
For finite-branching WSTS%with strong upward compatibility
, a basis of $\uparrow \post^*(s)$ is computable for every state $s$ iff the downward-reachability problem is decidable.
%i 			.e. given a state $s$ of a WSTS
% in the regarded class 
%with strong upward compatibility 
%and a decidable downward-closed set $D$, it can be decided whether $\exists s' \in D ~ s \to^* s'$. 
\end{proposition}

% \alain{rappeler l'idée de la preuve}
The idea behind the proof is the following. For deciding whether a downward-closed set $D$ is reachable from $s$, we check whether
$B_{\uparrow \post^*(s)} \cap D = \emptyset$, equivalent to $\post^*(s)\cap D = \emptyset$ by
Lemma~\ref{Lemma intersection}. For the converse direction, we compute the sequence of upward-closed
$U_n = \uparrow post^{\leq n}(s)$ until it becomes stationnary. 
Decidability of downward reachability leads to the decidability of the following stop condition:
asking whether $S \setminus U_n$ is reachable from $s$.


The characterization is used to show that Petri nets are $\post^*$-effective. It is well-known that Petri nets are WSTS with strong upward compatibility (Thm.~6.1 in \cite{DBLP:journals/tcs/FinkelS01}). 
Since VASS are WSTS with strong upward compatibility and since there is an algorithm that computes a finite basis of  $\uparrow \post^*(S)$, \cite{DBLP:conf/gg/Ozkan22} deduced that bounded state-resilience is decidable for VASS.
Hence state-resilience is decidable for Petri nets and VASS.
However, the hypothesis that $\uparrow \post^*$ is computable cannot be tested in the general WSTS framework. Moreover, we may show:

\begin{proposition}
There exist classes of WSTSs with strong upward compatibility for which there don't exist an algorithm computing a basis of $\uparrow \post^*$.
\end{proposition}


\begin{proof}
Let us show that Reset VASS, that are WSTSs with strong upward compatibility, don't enjoy the property that $\uparrow \post^*$ is computable.
Suppose that one are able to compute a finite basis of $\uparrow \post^*$ for Reset VASS. Then, one would be able to decide whether $0$ is reachable 
%in counter $i$ 
by examining if there is %some vector $v$ in the basis such that $v(i)=0$
$0$ in the basis%
. But reachability of $0$  %in a counter $i$ 
is undecidable for Reset VASS. 
% sont WSTS with strong compatibility. et l'accessibilité est undecidable.
%	$\uparrow post^*$ n'est pas calculable pour les LCS non plus car $\uparrow post^*= \uparrow \downarrow post^*$ n'est pas calculable ???
\end{proof}

%il existe des modèles où on peut calculer $\uparrow post^*$: inserted channel systems: on sait calculer $post^*$ qui est rationnel donc on sait calculer $\uparrow post^*$.


%
%si on garde strong mais on enlève effective basis of $post^*$:
%
%\begin{proposition}(à prouver)
%{\sc $k$-resilience}, hence {\sc bounded resilience}, is undecidable for effective WSTS with strong upward compatibility.
%\end{proposition}
%
%\begin{proof}
%pas de effective basis of $post^*$. leur algorithme n'est plus un algo. ex reset PN ?  \textcolor{red}{pas certain ! à faire Mathieu}
%\end{proof}






Unfortunately, state-resilience is undecidable for (general) WSTS even with strong monotony.
This stems from the fact that $t$-liveness is undecidable for reset Petri-Nets.


\begin{theorem}[Adjusting Theorem~5.5 from \cite{peterson1981petri}]
The  Reset Petri Net zero reachability problem can be reduced to the liveness problem.
\end{theorem}

\begin{proof}
If we wish to determine if $0 \in R(C_1, \mu_1)$ in any
reset Petri net $C_1 = (P_1, T_1, I_1, O_1, R_1 )$ (where $R_1(t) =$ places that are reset when t fires off), with initial marking $\mu_1$, we construct a
reset petri net $C_2 = (P_2, T_2, I_2, O_2, R_2 )$ with initial marking
$\mu_2$ which is live if and only if the zero marking is not reachable from $\mu_1$.

The reset PN $C_2$ is constructed from $C_1$ by the addition of two places $r_1$ and $r_2$
and $|P_1| +2$ transitions $s$, $\{ s_p | p \in P_1 \}$ and $s'$.

We first modify all transitions of $T_1$ to include $r_1$ as both an input and an output.
The initial marking $\mu_2$ will include a token in $r_1$. 


The place $r_1$ is a 'run' place; as long as the token remains in $r_1$ the transitions of $T_1$ can fire normally.
Thus any marking which is reachable in the places of $P_1$ is also reachable in $C_2$.



Transition $s$ is defined to have $r_1$ as an input and a null output.
This allows the token in $r_1$ to be removed, disabling all transitions in $T_1$
and "freezing" the marking of $P_1$.

Note that all transitions of $T_1$ are in conflict and, by construction if not by definition, no more than one transition can fire at a time.

The place $r_1$ and transition $s$ allow the net $C_1$ to reach any reachable marking and then for $s$ to fire and freeze the net at that marking.

Now we need to see if that marking is zero.

We introduce a new place $r_2$ and new transitions $s_p$ which have $p$ as input and $r_2$ as output.

If $p$ can ever become zero, $s_p$ is not live. The entire net is dead if
$s$ fires in the marking zero.

If we can always have some $p_i$ not be zero, then we can always fire some $s_{p_i}$, putting a token in $r_2$.

In this case we must put a token back in $r_1$ and assure that all transitions in $C_2$ are live.
We must be sure that $C_2$ is live even if $C_1$ is {\em not} live.
This is accomplished by a transition $s'$ which  "floods" the net $C_2$ with tokens, assuring that every transition is live if a token is ever put in $r_2$.
Transition $s'$ has $r_2$ as its input and every place of $C_2$ as output

Now if $0$ is reachable
in $R(C_1, \mu_1)$ 
then the net $C_2$ can also reach this marking
in the place of $P_1$ by executing the same sequence of transition firings.
Then $s$ can fire, freezing the $C_1$ subset.
Since $mu(p_i) = 0$ for all $p_i \in P_1$, no transition $s_{p_i}$ with $p_i \in P_1$ can fire, and $C_2$ is dead.
Thus if $0$ is reachable then $C_2$ is not live.

Conversey, if $C_2$ is not live, then a marking $\mu$ must be reachable in which 
$\mu(r_2) = 0$ and there is no reachable state in which $r_2$ has a token
(in particular, since we do not allow token removal from $r_2$, the marking $\mu$ must be reached in a sequence of transitions that do not place any token in $r_2$.)
% (Rappel: tant que il y a un token quelque part, on peut mettre un token en r_2
% et r_2 commence sans token)
If $r_2$ has no token and cannot get any, then the transitions $s_p$ are not live, and the markings of $p$ for $p \in P_1$ must be zero. 
Thus if $C_2$ is not live then a marking is reachable in which the marking of each $p$ in $P_1$ is zero. 


\end{proof}

\begin{corollary}
Reset Petri Net liveness is undecidable 
\end{corollary}

\begin{corollary}
Reset Petri Net $t$-liveness is undecidable 
\end{corollary}


\alain{mal placé}
\begin{proposition}\label{reductions}
In WSTS, coverability and $t$-liveness are reducible to the state resilience problem.
%	home state and reachability
\end{proposition}


\begin{proof}

\begin{itemize}
\item Let us choose $\Bad=S= \downarrow S$ and $\Safe=\uparrow x$ then reachable resilience is equivalent to coverability of $x$ from $s$.

\item $t$-liveness  can be expressed as the following formula
$ ~ \forall s' \in S, ~ s \rightarrow^* s' \implies \exists s'' \in U_t, ~ s' \rightarrow^{*} s''$ 
where
$U_t=\uparrow \pred(t)$
is the upward closure of the preconditions to use transition $t$.  
The problem reduces itself to the reachable resilience problem
where $\Bad=S$ and $\Safe = \uparrow \pred(t)$.

%\item the home state problem can be expressed as $\ldots$
\end{itemize}

\end{proof}



\iffalse

\begin{theorem}
The downward reachability problem is reducible to the state resilience problem.
\end{theorem}

\begin{proof}
Let $s \in S$, and a downward-closed set $D$. \alain{je ne comprends pas cette "preuve"}
Take $\Safe = \emptyset$ and $\Bad = D$.
The state resilience problem on $\Safe,\Bad$ asks
whether $\Bad \cap \post^*(s) \rightarrow^* \Safe$  that is equivalent to $\Bad \cap \post^*(s) \subseteq \emptyset$.
If the answer is negative then $s \to^* \Bad$,
else $s \not\to^* \Bad$.
\end{proof}

\fi

\alain{mal placé}


Since $t$-liveness is undecidable for reset Petri-Nets that are WSTS with strong monotony, from Proposition \ref{reductions},  we deduce that state-resilience is undecidable for WSTS with strong monotony.

\begin{theorem}
{\sc State-resilience} is undecidable for WSTS with strong monotony.
\end{theorem}






\begin{proposition}
In WSTS with strong compatibility and effective pred-basis, the bounded state-resilience problem is
reducible to the $k$-state-resilience problem.
\end{proposition}

\begin{proof}
% strong WSTS
% $\pred^*(I) = \pred^{k}(I)$
% Check all $k$ until $\pred^*(I) = \pred^{k}(I)$.
Since $\Safe=\uparrow \Safe$ and
$\mathscr{S}=(S,\rightarrow,\leq)$ is a WTSTS with strong %upward-
compatibility, then $\pred^n(\Safe)= \uparrow~\pred^n(\Safe)$ for all $n \in \N$,
and there exists $n_0 \in \N$ such that 
$\pred^{n_0}(\Safe) = \uparrow \pred^{n_0}(\Safe) = \uparrow \pred^*(\Safe) = \pred^*(\Safe)$.
We
\end{proof}



\begin{proposition}
In WSTS with strong compatibility and effective pred-basis,  $\Safe=\uparrow \Safe$, the bounded-state-resilience problem is equivalent to the state-resilience problem.
\end{proposition}

\begin{proof}
Since $\Safe=\uparrow \Safe$ and
$\mathscr{S}=(S,\rightarrow,\leq)$ is a WTSTS with strong %upward-
compatibility, then $\pred^n(\Safe)= \uparrow~\pred^n(\Safe)$ for all $n \in \N$,
and there exists $n_0 \in \N$ such that 
$\pred^{n_0}(\Safe) = \uparrow \pred^{n_0}(\Safe) = \uparrow \pred^*(\Safe) = \pred^*(\Safe)$.
Hence the equivalence.
\end{proof}

\begin{corollary}
Bounded reachable-resilience and 
$k$ reachable-resilience are undecidable for WSTS with strong monotony.
\end{corollary}

\begin{proof} 
  From
  cf
the two  theorems above. 
\end{proof}











Keeping the $\uparrow post^*$ effectiveness hypothesis but loosening the strong compatibility one still yields some decidability result for the general reachable-resilience problem.


\begin{lemma}\label{Lemma intersection}
Let $A \subseteq S$, $D \subseteq S$ be a downward-closed set and $U \subseteq S$ be an upward-closed set. 
Then $A \cap D \subseteq U$  iff $ (\uparrow  A) \cap D \subseteq U$.
\end{lemma}


\begin{proof}
Let us suppose that $A \cap D \subseteq U$. Then ${\uparrow (A \cap D)} \subseteq {\uparrow U} = U$.
Let us show that $({\uparrow A}) \cap D \subseteq {\uparrow (A \cap D)}$.
Let $x \in ({\uparrow A}) \cap D$, then there exists $a \in A$ such that $x \geq a$.
Since $x \in D$ and $D$ is downward-closed, we also have $a \in D$.
Hence $a \in A \cap D$ and then $x \in { \uparrow (A \cap D)}$.
In the other direction,
since $A \subseteq {\uparrow A}$, the inclusion
$({\uparrow  A}) \cap D \subseteq U$ implies
$A \cap D \subseteq ({\uparrow  A}) \cap D \subseteq U$.
\end{proof}



\begin{theorem}{(Adjusting Theorem 1 from \cite{DBLP:journals/corr/abs-2108-00889})}
{\sc Reachable-resilience} is decidable for (not necessarily strong) WSTS with effective 
$\uparrow$ $\post^*$ basis.
\end{theorem}


\begin{proof}
Let $B_p$ be a basis of $\uparrow \post^*(s)$, $B_\Safe$ a basis of $\Safe$
and $\Bad$ decidable downward-closed.
By applying Lemma~\ref{Lemma intersection} twice, we obtain

$$ post^*(s) \cap \Bad \subseteq \pred^*(\Safe) \equiv B_p \cap \Bad \subseteq \pred^*(\Safe)$$


Since $B_p$ is finite and $\Bad$ is decidable, we can directly compute $ B_p \cap \Bad$.
% For every element of $ B_p \cap J$, checking that it is in $\pred^*(I)$ is the same as checking coverability of I, and thus decidable.
We can compute a basis of $\pred^*(\Safe)$ from $B_\Safe$, and hence check that $B_p \cap \Bad \setminus \pred^*(\Safe) = \emptyset$. 
\end{proof}

% In the proof of Thm. 1, it was crucial that we have strong compatibility. This approach does not work
% for WSTSs in general. We loose precision when we only demand compatibility. Thus, we conjecture
% that both resilience problems are undecidable for WSTSs in general, but this question remains still open.
%
% Well, maybe their version of resilience but resilience with * seems fine.
%

However when removing strong compatibility, precision is lost and the algorithm do not work anymore.

\begin{proposition}
The algorithm from \cite{DBLP:conf/gg/Ozkan22} for {\sc $k$-reachable-resilience} terminate but is incorrect for WSTS with upward compatibility (not strong) and an effective basis of $\uparrow \post^*$.
\end{proposition}

\begin{proof}[Sketch]
Let us consider a LCS where erasing a message take one step. Then the upward compatibility is not strong. 
For instance with a rule $\delta(q,b) = \text{ add some }b $,
we have $(q,b) \to (q,bb)$, $(q, baaa) \geq (q,b)$ and
$(q, baaa) \to^* (q,bb)$ however it takes more than a single step.

In this case then $\pred(\uparrow \{(q,b)\})$ is not upward-closed. Hence 
$post^* (s) \cap D \subseteq \pred(\uparrow \{(q,b)\})$
do not imply
$\uparrow post^* (s) \cap D \subseteq \pred(\uparrow \{(q,b)\})$ for a downward-closed set $D$.
In particular by lossiness $(q, \epsilon)$ would belong to
$post^* (s)$,
hence $(q,a)$, $(q,aa)$, etc. would belong to $\uparrow post^* (s)$ although not necessarily to
$post^* (s)$. $(q,aaa)$ not being in $pred(\uparrow \{ (q,b)\})$ means the algorithm 
from \cite{DBLP:conf/gg/Ozkan22} would deduce that $1$-rechable-resilience does not hold in this example when $\Safe=\uparrow \{(q,b)\}$ and $\Bad =S$,
because $\uparrow post^* (s) \cap S \not\subseteq \pred(\uparrow \{(q,b)\})$,
despite having 
$post^* (s) \cap S \subseteq \pred(\uparrow \{(q,b)\})$.

\iffalse
\mathieu{

On considère un LCS, où on autorise à effacer des messages (lossyness) mais effacer un message prends une étape (contrairement à [ref], où ils font une sorte de cloture de effacer-transition-effacer). On n'a alors pas la strong compatibility: 

On prends: $(q, b) 	\to (q,bb)$ par exemple et $(q, baaaaaa) \geq (q,b) $, alors
$(s, baaaaaa) \to^* (s,b) \to (s,bb)$
MAIS

C'est pas "en une étape".

(On considère -il faut le mentionner/vérifier- que on ne peut effaçer que d'un coté ? et pas au milieu?)

Dans ce cas là, du coup, $pred(\uparrow \{(q,b)\}$ n'est pas clos par le haut. \\

Revenons au Corollaire

On voudrais avoir

$post^* (s) \cap J \subseteq I^k$

MAIS pas

$ (\uparrow post^* (s)) \cap J \subseteq I^k$ \\


Ça serait un cas où leurs algorithme vas dire 
"On n'a pas $(\uparrow post^* (s)) \cap J \subseteq I^k$ donc on n'a pas la $k$-résilience "

Alors qu'on aurait la $k$-résilience (i.e. $post^* (s) \cap J \subseteq I^k$)

Pour $I^k$, le contre exemple prendrait du coup $pred(\uparrow \{ (q,b)\})$ qui n'est pas clos par le haut.

On voudrait

$post^*(s) \cap J \subseteq pred(\uparrow \{ (q,b)\})$


Je propose de prendre $J$ = ensemble des configurations je pense le truc ici doit venir de
$\uparrow post^* (s)$ being too big
donc autant pas se restreindre du tout sur $J$


$post^*(s) \subseteq pred(\uparrow \{ (q,b)\})$

Si $s=(q,b)$ par exemple, et que on peut aller de $q$ vers $q$ en écrivant un 
$b$ ? et évidement en perdant le dernier message (parce qu'on est lossy). Et c'est tout, disons.

Déjà par lossiness $(q,\epsilon)$ serait dans $post^*((q,b))$.

Et aussi dans $pred(\uparrow \{ (q,b)\})$ puisque $(q,\epsilon) \to (q,b)$.

Donc on aurait:

$post^*((q,b))  \subseteq pred(\uparrow \{ (q,b)\})$

Et on aurait $(q,aaaaaa)$ dans 
$\uparrow post^* ((q,b))$ puisque $(q,\epsilon)$ est dans $post^* ((q,b))$.

Hors $(q,aaaaa)$ est pas dans $pred(\uparrow \{ (q,b)\})$
(même si il est dans $pred^*(\uparrow \{ (q,b)\})$).

}
\fi 
 
\end{proof}


\begin{proposition}
\textcolor{red}{
{\sc bounded resilience} is undecidable for WSTS with upward compatibility with an effective basis of $post^*$.
CONJECTURE
}
\end{proposition}

\begin{proof}
 \textcolor{red}{pas certain ! à faire Mathieu}
\end{proof}






% Let us deduce that effective basis of $post^*$ ex reset PN ?

 \alain{resilience decidable for LCS ? LCS sont-ils strong (quelle sémantique ?) et $\uparrow post^*(S)$ is computable ?}

We may consider context-free grammars.

\begin{corollary}
{\sc resilience} is decidable for finite automata and context-free grammars (seen as transition systems)
\end{corollary}

\begin{proof}

  \textcolor{red}{à faire Mathieu}
Context-free grammars are WSTS \cite{DBLP:journals/tcs/FinkelS01} \alain{monotony ne semble pas strong...}avec $\uparrow post^*$ calculable (because the reachability set of a pushdown machine is an effectively computable regular language) ???? resilience decidable.
\end{proof}


\cite{DBLP:journals/ipl/BouajjaniEFMRWW00}


\subsection{Case: $\Safe = \downarrow \Safe$ and $\Bad = \uparrow \Bad$}











