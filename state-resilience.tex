



\section{State-resilience}


Resilience is a strong property since it implies that from every element of $\Bad$ there must exist a path to $\Safe$. However, when one considers a system with an initial state $s_0$, it could be sufficient to ask that only from $\Bad \cap \post^*(s_0)$, there must exist a path to $\Safe$. 
Since we still consider $\Bad$ and $\Safe$ complement of each others, this is akin to asking whether from $\post^*(s_0)$ there always exists a path to $\Safe$. 
The three previous problems become:




\problemx{State-resilience problem (SRP)}
{A transition system $\mathscr{S}=(S,\rightarrow)$, $s \in S$ and two sets $\Safe, \Bad \subseteq S$.}
% {$\Bad \cap \post^*(s)  \rightarrow^{*} \Safe $ ? \newline}
{$\post^*(s)  \rightarrow^{*} \Safe $ ? \newline}

\problemx{$k$-state-resilience problem (kSRP)}
{A transition system $\mathscr{S}=(S,\rightarrow)$, $s \in S$ and two sets $\Safe, \Bad \subseteq S$.}
% { $\Bad \cap \post^*(s) \longrightarrow^{\leq k} \Safe$ ?  \newline}
{ $\post^*(s) \longrightarrow^{\leq k} \Safe$ ?  \newline}

\problemx{bounded-state-resilience problem (BSRP)}
{A transition system $\mathscr{S}=(S,\rightarrow)$, $s \in S$ and two sets $\Safe, \Bad \subseteq S$.}
{$\exists k \geq 0$ such that $\mathscr{S}$ is $k$-state-resilient ?\newline}



\iffalse
\problemx{State resilience problems}
{A transition system $\mathscr{S}=(S,\rightarrow)$, $s \in S$, two sets $\Safe, \Bad \subseteq S$, $k \in \mathbb{N}$.}
{ ({\sc state-resilience problem (SRP)}) $\post^*(s) \longrightarrow^{*} \Safe$ ?\newline  
({\sc $k$-state-resilience problem (kSRP)})		$\post^*(s) \longrightarrow^{\leq k} \Safe$ ?\newline
({\sc bounded-state-resilience problem (BSRP)})	$\exists k \geq 0$ such that $\mathscr{S}$ is 
 $k$-resilient ?\newline}
\fi


Since these problems are undecidable for general infinite-state transition systems, we restrict our study to WSTS.
As in the Section~3, we study decidability results for $\Safe$ downward-closed and upward-closed. 


\subsection{Case: $\Safe = \uparrow \Safe$% and $\Bad = \downarrow \Bad$
}



Unfortunately, {\sc State-resilience} is undecidable for (general) WSTS even with strong upward-compatibility.
This stems from the fact that it is undecidable in the particular case of Reset VASS,
where  $t$-liveness is both undecidable and 
 reducible to {\sc State-resilience}.


Reset VASS extend the basic VASS model with special “reset
transitions” that resets (set to $0$) some coordinates in the vector. Let us recall their definition here.
\begin{definition}
A {\em Reset VASS} in dimension $d$ (Reset $d$-VASS for short) is a finite 
% $\mathds{Z}^d$
labeled directed graph $V = (Q,T)$, where $Q$ will be referred to as the {\em control-states} of $V$, and where 
%$T \subseteq Q \times \mathds{Z}^d \times Q$
$T \subseteq Q \times Op \times Q$
 will be referred to as the {\em control-transitions} of $V$,
where $Op = \{ add(\textbf{z}) \mid \textbf{z} \in \mathds{Z}^d\} \cup 
		\{ reset(i) \mid i \in \{1,\ldots,d\} \}$.
\end{definition}

Again $Q \times \N^d$
 denotes the set of configurations of $V$.
For every configurations $p(\textbf{u}), q(\textbf{v}) \in Q \times \N^d$ and every control-transition $t$ we write
$p(\textbf{u}) \xrightarrow{t} q(\textbf{v})$ when 
\begin{samepage}\begin{itemize}
\item  $t = (q,add(\textbf{z}),q') \in T$
% then for all $\textbf{u} \in \N^d$ such that  
% $\textbf{u}+\textbf{z} \geq 0$
% $q(\textbf{u}) \xrightarrow{\textbf{z}} q'(\textbf{u}+\textbf{z})$,
and $\textbf{u}+\textbf{z} = \textbf{v} \geq 0$,
\item $t = (q,reset(\gamma),q') \in T$ 
% then for all $\textbf{u} \in \N^d$ 
% $q(\textbf{u}) \xrightarrow{z} q'(\textbf{u}')$,  where 
and
$\textbf{v}[\gamma] = 0$, and $\textbf{v}[\gamma'] = \textbf{u}[\gamma']$ for all $\gamma' \in \{1,\ldots, d\} \setminus \gamma$.
\end{itemize} \end{samepage}

It is well known that Reset $d$-VASS are WSTS~\cite{dufourd1998reset}. 
Moreover, we are interested in the 
%following
 undecidable \cite{araki1976PN} decision problem of {\em zero-reachability} in Reset $d$-VASS, which consists in, given a
Reset $d$-VASS $V=(Q,T)$, and $p(\textbf{u}) \in Q \times \N^d$,
deciding whether $\exists q \in Q ~ p(\textbf{u}) \to^* q(\textbf{0})$.
%
We reduce the zero-reachability problem to the problem of deciding whether a control-transition is live, that is, whether it is always ,
which we then reduce to {\sc State-resilience}.
A control-transition $t$ of a Reset $d$-VASS is {\em live} in a configuration $r(\textbf{w})$ if for each $q(\textbf{v}) \in \post^*(r(\textbf{w}))$ there exists a 
 $p(\textbf{u})$ with $q(\textbf{v}) \to^* p(\textbf{u})$ such that $t$ is enabled in $p(\textbf{u})$. We say the whole Reset $d$-VASS is live if all its control-transitions are
live. This leads to the following problem.

\problemx{$t$-liveness}
{Reset $d$-VASS $V=(Q,T)$, $t \in T$, initial configuration $s_0$}
{Is $t$ live in $s_0$ ? \\}


To better discuss $t$-liveness let us define more formally the set of configurations such that $t$ is enabled
$pre(t)=\{ p(\textbf{u}) \in S \mid \exists q(\textbf{v})$ such that $ p(\textbf{u}) \xrightarrow{t} q(\textbf{v}) \}$.



\begin{proposition}\label{reductions}
{\sc $t$-liveness} is reducible to {\sc State-resilience} in Reset $d$-VASS.
\end{proposition}


\begin{proof}
We reformulate $t$-liveness 
in a 
% WSTS $\mathscr{S}=(S,\rightarrow, \leq)$ with an initial state $s_0$ 
Reset $d$-VASS $(Q,T)$ 
with initial configuration $s_0$
as the following formula
\[ ~ \forall p(\textbf{u}) \in Q \times \N^d, 
~ s_0 \rightarrow^* p(\textbf{u}) \implies \exists q(\textbf{v}) \in U_t, ~ p(\textbf{u}) \rightarrow^{*} q(\textbf{v})\]
where
$U_t=\uparrow pre(t)$ 
is the upward closure of the preconditions to fire transition $t$.  
The problem reduces itself to {\sc State-resilience}
where $\Safe = U_t$.
\end{proof}


The following theorem is a transposition of Theorem~5.5 from \cite{peterson1981petri} from Petri nets to Reset VASS, whose proof can be seen in Appendix~\ref{appendix}.
\begin{proposition}\label{liveness reset}
The  zero reachability problem can be reduced to the $t$-liveness problem in Reset VASS.
\end{proposition}

Since the zero-reachability problem for Reset $d$-VASS is undecidable, the reduction implies 
% the following:
%
%
{\sc %$ Reset $d$-VASS 
$t$-liveness} is undecidable.
Since {\sc %$Reset $d$-VASS 
$t$-liveness} is undecidable, from Proposition~\ref{reductions},  we deduce that {\sc State-resilience} is undecidable  for Reset $d$-VASS, which are WSTS with strong compatibility. Hence {\sc State-resilience} is undecidable  for WSTS with strong upward-compatibility. This undecidability result furthermore implies the undecidability of the other two state resilience problems by straightforward reductions.


\begin{theorem}\label{srp up down}
{\sc State-resilience},
{\sc Bounded-state-resilience} and
{\sc $k$-state-resilience}
are undecidable for strongly compatible WSTS with effective pred-basis
when
$\Safe=\uparrow \Safe$.
\end{theorem}


\begin{proof}
{\sc State-resilience} itself is undecidable from Proposition~\ref{reductions} since 
{\sc %Reset $d$-VASS 
$t$-liveness} is undecidable.
% \begin{proposition}
% \end{proof}
% \begin{proposition}
In WSTS with strong compatibility and effective pred-basis, {\sc Bounded-state-resilience} is
reducible to {\sc $k$-state-resilience}:
% \end{proposition}
% 
% \begin{proof}
since $\Safe=\uparrow \Safe$ and
$\mathscr{S}=(S,\rightarrow,\leq)$ is a WSTS with strong %upward-
compatibility, then $\pred^{\leq n}(\Safe)= \uparrow~\pred^{\leq n}(\Safe)$ for all $n \in \N$,
and there exists $n_0 \in \N$ such that 
$\pred^{\leq n_0}(\Safe) = \uparrow \pred^{\leq n_0}(\Safe) = \uparrow \pred^*(\Safe) = \pred^*(\Safe)$.
We compute 
$n_0$, then iteratively check whether $k$-state-resilience 
% \alain{$k$-state resilience ou $k$-state-resilience ?}
hold for $k$ from $0$ to $n_0$.  
% \end{proof}
Furthermore, in WSTS with strong compatibility and effective pred-basis,  $\Safe=\uparrow \Safe$, {\sc Bounded-state-resilience} is equivalent to {\sc State-resilience},
% \end{proposition}
%
% \begin{proof}
since 
$\pred^{\leq n_0}(\Safe) = \uparrow \pred^{\leq n_0}(\Safe) = {\uparrow \pred^*(\Safe)} = \pred^*(\Safe)$.
Hence the %equivalence, and
 undecidability of {\sc Bounded-state-resilience}
and 
 {\sc $k$-state-resilience}. 
\end{proof}






On the positive side, let us recall a result about {\sc Bounded-state-resilience} decidability (called resilience in \cite{DBLP:conf/gg/Ozkan22,DBLP:journals/corr/abs-2108-00889}).

\begin{theorem}\cite{DBLP:conf/gg/Ozkan22,DBLP:journals/corr/abs-2108-00889}\label{ref ozkan}
{\sc Bounded-state-resilience} and {\sc $k$-state-resilience} are decidable for WSTS $S$ with strong compatibility and such that $\uparrow \post^*(s)$ is computable for $s \in S$
when
$\Safe=\uparrow \Safe$.
\end{theorem}

We may immediately generalyse this last result by strengthening to \emph{unbounded} {\sc State-resilience}. The proof is essentially the same than the previous one.

\begin{corollary}\label{postcomputable}
{\sc State-resilience} is decidable for WSTS with strong compatibility and such that $\uparrow \post^*(s)$ is computable for $s \in S$
when
$\Safe=\uparrow \Safe$.
\end{corollary}

\begin{proof}
%From Fact~\ref{stop condition},
Since $\mathscr{S}$ is a WSTS there exists $n_0 \in \N$ such that
$\pred^*(\Safe) =  \pred^{\leq n_0}(\Safe)$. We can compute this $n_0$ by iteratively computing 
%\alain{mauvaises notations: $k, k_m, Safe^k,...$ n'a aucun sens...}
$\pred^{\leq n+1}(\Safe)$ from $\pred^{\leq n}(\Safe)$, checking 
$\pred^{\leq n+1}(\Safe) = \pred^{\leq n}(\Safe)$, 
returning $n$ if that is the case.
Then, because {\sc $n_0$-state-resilience} is decidable, 
checking $\uparrow \post^*(s) %\cap \Bad
 \subseteq \pred^{\leq n}(\Safe) = \pred^*(\Safe)$ is,
and {\sc State-resilience} is decidable.
\end{proof}

The proof of Theorem~\ref{ref ozkan} rely on the computability of $\uparrow \post^*(s)$ and on the following lemma.

\begin{lemma}\label{Lemma intersection}
Let $A \subseteq S$, $D \subseteq S$ be a downward-closed set and $U \subseteq S$ be an upward-closed set. 
Then $A \cap D \subseteq U$  iff $ (\uparrow  A) \cap D \subseteq U$.
\end{lemma}


\begin{proof}
Let us suppose that $A \cap D \subseteq U$. Then ${\uparrow (A \cap D)} \subseteq {\uparrow U} = U$.
Let us show that $({\uparrow A}) \cap D \subseteq {\uparrow (A \cap D)}$.
Let $x \in ({\uparrow A}) \cap D$, then there exists $a \in A$ such that $x \geq a$.
Since $x \in D$ and $D$ is downward-closed, we also have $a \in D$.
Hence $a \in A \cap D$ and then $x \in { \uparrow (A \cap D)}$.
In the other direction,
since $A \subseteq {\uparrow A}$, the inclusion
$({\uparrow  A}) \cap D \subseteq U$ implies
$A \cap D \subseteq ({\uparrow  A}) \cap D \subseteq U$.
\end{proof}




The computability of $\uparrow \post^*(s)$ however seems a strong hypothesis. What are the WSTS for which $\uparrow \post^*(s)$ is computable for $s \in S$ ?
Ozkan \cite{DBLP:conf/gg/Ozkan22} argues that it is precisely the WSTS for which the following problem is decidable.

\problemx{Downward-reachability problem}
{A transition system $\mathscr{S}=(S,\rightarrow)$, $s \in S$ and a downward-closed set $D
\subseteq S$.}
% {$\exists s' \in D ~ s \to^* s'$? \newline}\alain{ecrire $s  \to^* D$}
{$s  \to^* D$? \newline}

%\"Ozkan
\begin{proposition}[Proposition 1 in \cite{DBLP:conf/gg/Ozkan22}]\label{post*}
For finite-branching WSTS%with strong compatibility
, a basis of $\uparrow \post^*(s)$ is computable for every state $s$ iff the downward-reachability problem is decidable.
%i 			.e. given a state $s$ of a WSTS
% in the regarded class 
%with strong compatibility 
%and a decidable downward-closed set $D$, it can be decided whether $\exists s' \in D ~ s \to^* s'$. 
\end{proposition}

% \alain{rappeler l'idée de la preuve}
The idea behind the proof is the following. For deciding whether a downward-closed set $D$ is reachable from $s$, one checks whether
$B_{\uparrow \post^*(s)} \cap D = \emptyset$, 
where $B_{\uparrow \post^*(s)}$ is a basis of $\uparrow \post^*(s)$,
%\alain{rapeler $B_{\uparrow \post^*(s)}$} 
 that is equivalent to $\post^*(s)\cap D = \emptyset$ by
Lemma~\ref{Lemma intersection}. For the converse direction, one computes the sequence of upward-closed sets
$U_n = \uparrow \post^{\leq n}(s)$ until it becomes stationnary. 
Decidability of downward-reachability leads to the decidability of the following stop condition:
asking whether $S \setminus U_n$ is reachable from $s$.


% \mathieu{Quelque chose de plus à dire sur la charactérisation?}


More concretely,
VASS for instance are $\uparrow \post^*$-effective WSTS \cite{DBLP:journals/corr/abs-2108-00889}. 
It is well-known that 
% Petri nets are WSTS with strong  compatibility (Thm.~6.1 in \cite{DBLP:journals/tcs/FinkelS01}). 
% Since 
VASS are WSTS with strong compatibility and since there is an algorithm that computes a finite basis of  $\uparrow \post^*(s)$, \cite{DBLP:conf/gg/Ozkan22} deduced that {\sc Bounded-state-resilience} is decidable for VASS.
Hence {\sc State-resilience} is decidable for %both Petri nets and 
VASS.
However, the hypothesis that $\uparrow \post^*$ is computable cannot be tested in the general WSTS framework. Moreover, we may show:

\begin{proposition}
There exist classes of WSTSs with strong 
%(upward)
 compatibility for which there doesn't exist an algorithm computing a basis of $\uparrow \post^*$.
\end{proposition}


\begin{proof}
Let us show that Reset VASS, that are effective WSTSs with strong compatibility, don't enjoy the property that $\uparrow \post^*$ is computable.
Suppose that one are able to compute a finite basis of $\uparrow \post^*$ for Reset VASS. 
Then, {\sc State-resilience} would be decidable for Reset VASS, which leads to a contradiction.
\end{proof}








Keeping the $\uparrow \post^*$ effectiveness hypothesis but loosening the strong compatibility one still yields some decidability result for the general {\sc State-resilience }. Adjusting Theorem 1 from \cite{DBLP:journals/corr/abs-2108-00889}:


\begin{theorem}\label{post srp}
{\sc State-resilience} is decidable for 
 WSTS with effective 
$\uparrow$ $\post^*$ basis
when
$\Safe=\uparrow \Safe$.
\end{theorem}


\begin{proof}
Let $B_{\uparrow \post^*(s)}$ 
%\alain{notation fluctuante}
 be a basis of $\uparrow \post^*(s)$, $B_\Safe$ a basis of $\Safe$.
By applying Lemma~\ref{Lemma intersection} twice, we obtain
\[ \post^*(s) %\cap \Bad
 \subseteq \pred^*(\Safe) \text{ iff } B_{\uparrow \post^*(s)} %\cap \Bad 
 \subseteq \pred^*(\Safe)\]
Since $B_{\uparrow \post^*(s)}$ is finite and we can compute a basis of $\pred^*(\Safe)$ from $B_\Safe$, we can check that $B_{\uparrow \post^*(s)} %\cap \Bad
 \setminus \pred^*(\Safe) = \emptyset$. 
\end{proof}





However when removing strong compatibility, precision is lost.
Since $\pred(\uparrow \Safe)$ is not necessarily upward-closed, it is possible to have 
 $\uparrow \post^* (s) \cap S \not\subseteq \pred(\Safe)$,
despite having 
$\post^* (s) \cap S \subseteq \pred( \Safe)$.
In such a case the algorithm from
\cite{DBLP:conf/gg/Ozkan22} would deduce that $1$-rechable-resilience does not hold,
which is incorrect.

Thus in case of a WSTS with an effective basis of $\uparrow \post^*$ and (not strong) compatibility, we don't know the decidability status of {\sc $k$-state-resilience} and 
{\sc Bounded-state-resilience}. 


Results synthesis in the case $\Safe = \uparrow \Safe$:
\begin{center}
\begin{tabular}{ | l | c | c | c | c |}
\hline  Hypothesis & strong %upward 
			compatibility ~ & $\uparrow \post^*$ effective 
			& strong %upward 
					compatibility \textit{+} $\uparrow \post^*$ effective \\ \hline
   SRP & Undecidable (Thm~\ref{srp up down}) & Decidable (Thm~\ref{post srp})  & Decidable (Thm~\ref{postcomputable})\\ \hline
   BSRP & Undecidable (Thm~\ref{srp up down}) &  ??  & Decidable (Thm~\ref{ref ozkan}) \\ \hline
      kSRP & Undecidable (Thm~\ref{srp up down}) & ?? & Decidable (Thm~\ref{ref ozkan}) \\ \hline
 \end{tabular}
\end{center}


\subsection{Case: $\Safe = \downarrow \Safe$% and $\Bad = \uparrow \Bad$
}



Unfortunately the {\sc State-resilience} problem is undecidable for WSTS in the case $\Safe = \downarrow \Safe$. As for resilience in WSTS when $\Safe = \downarrow \Safe$, it stems from undeciability of the corresponding problem in Minsky machines, the executions of which can be simulated by Reset-VASS, as seen in Appendix~\ref{HS-Minsk}. 

\begin{theorem}\label{srp down up}
{\sc State-resilience} is undecidable for effective WSTS with  strong  compatibility 
when
$\Safe=\downarrow \Safe$.
\end{theorem}



Despite this, it is possible to yield positive results. Indeed, in many ways the case where $\Safe = \downarrow \Safe$
is symmetrical to the case $\Safe = \uparrow \Safe$.
%
For instance one can write the following lemma:

\begin{lemma}(Symmetrical from Lemma~\ref{Lemma intersection})\label{Lemma intersection 2}
Let $A \subseteq S$, $D \subseteq S$ be a downward-closed set and $U \subseteq S$ be an upward-closed set. 
Then $A \cap U \subseteq D$  iff $ (\downarrow  A) \cap U \subseteq D$.
\end{lemma}

\begin{proof}
Let us suppose that $A \cap U \subseteq D$. Then ${\downarrow (A \cap U)} \subseteq {\downarrow D} = D$. Let us show that $({\downarrow A}) \cap U \subseteq {\downarrow (A \cap U)}$. Let $x \in ({\downarrow A}) \cap U$, then there exists $a \in A$ such that $x \leq a$. Since $x \in U$ and $U$ is upward-closed, we also have $a \in U$. Hence $a \in A \cap U$ and then $x \in { \downarrow (A \cap U)}$. In the other direction, since $A \subseteq {\downarrow A}$, the inclusion $({\downarrow  A}) \cap U \subseteq D$ implies $A \cap U \subseteq ({\uparrow  A}) \cap U \subseteq D$.
\end{proof}


In the case of a WSTS with \emph{downward} compatibility, not necessarily strong,
then $\Safe$ downward-closed implies $\pred^*(\Safe)$ downward-closed and
Lemma~\ref{Lemma intersection 2} can be used to show that
if $\Safe = \downarrow \Safe$,
then
$\post^*(s) %\cap \Bad 
\subseteq \pred^*(\Safe)$  iff $ (\downarrow  \post^*(s)) 
%\cap \Bad 
\subseteq \pred^*(\Safe)$.


\begin{theorem}\label{downward srp}
{\sc State-resilience} is decidable for ideal-effective WSTS with downward and upward compatibilities,
$\Safe = \downarrow \Safe$.
\end{theorem}

\begin{proof}
In order to decide whether $\post^{\leq n}(s) %\cap \Bad
 \subseteq \pred^*(\Safe)$, we execute two procedures in parallel,
one looking for a resilience certificate and one looking for a non-resilience certificate.
Procedure 1 enumerates inductive invariants in some fixed order $D_1$ , $D_2$ , $\ldots$ , i.e. downward-closed subsets $D_i \subseteq S$ such that $\downarrow \post(D_i ) \subseteq D_i$. 
Every inductive invariant $D_i$ is an “over-approximation” of $\downarrow \post^*(s)$ if it contains $s$.
Notice that, by 
upward compatibility, $\downarrow \post^*(s)$ is such an inductive invariant and may eventually be found.

Procedure 1 stops when it finds an invariant $D$ such that
$D  %\cap \Bad
 \subseteq \pred^*(\Safe)$. 
Indeed
$D % \cap \Bad 
\subseteq  \pred^*(\Safe)$ implies
$\downarrow \post^*(s) % \cap \Bad
 \subseteq  \pred^*(\Safe)$
since $ \downarrow \post^*(s)  \subseteq D$.

The second procedure iteratively computes
$\post^{\leq n}(s) %\cap \Bad
$
until it finds an element
not in $\pred^*(\Safe)$.
\end{proof}



Strong downward compatibility implies furthermore the decidability
of {\sc $k$-state-resilience} and {\sc bounded-state-resilience}.

\begin{corollary}\label{downward brp}
{\sc $k$-state-resilience} and {\sc bounded-state-resilience} are decidable for ideal-effective WSTS with strong downward compatibility,
$\Safe = \downarrow \Safe$.
\end{corollary}




