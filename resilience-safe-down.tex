

%%%%%%%%
\subsection{Case: $\Bad=\uparrow \Bad$.}
%
%		cas unbounded counters
%

let us choose $\Bad$ as the set of states from which the counter $c_{mutex}$ is not bounded by $k$.
%			at least one counter is unbounded. 
This set is upward-closed by (upward) compatibility in VASS.

\subsubsection{Subcase: $\Safe=\downarrow \Safe$}

As an example, let us choose $\Safe=S-\Bad$ then since $\Bad=\uparrow \Bad$, we have: $\Safe=\downarrow \Safe$.
%
% \alain{definir  ideal-effective WSTS}
%
\begin{theorem}\label{up-down}
The resilience problem is decidable for ideal-effective WSTS with 
$\Safe=\downarrow \Safe$
and $\Bad=\uparrow \Bad$
and
the additional hypothesis that
for all downward-closed set $D \subseteq S$, the set $\pred^*(D)$ is downward-closed.
% \alain{est-ce que  $\pred(D)$ is downward closed avec D downward closed serait suffisant ? si l'ordre est omega2 alors closbas+inclusion est wqo donc il faudrait juste que la suite croissante $pred^n(D)+le reste$ converge...}
\end{theorem}

\begin{proof}
By hypothesis $\pred^*(\Safe)$ is downward-closed, since $\Safe$ is downward-closed.
%  Let $\{J_1, J_2,...,J_n\}$ be the ideal decomposition of $\pred^*(\Safe)$ and $\{b_1,b_2,...,b_m\}$ be the (unique) minimal basis of $\Bad$.
The resilience problem can be reformulated as 
% $\uparrow \{b_1,b_2,...,b_m\} \subseteq J_1 \cup J_2 \cup \cdots \cup J_n$.
$\Bad \subseteq  \pred^*(\Safe)$.
Since $\mathscr{S}=(S,\rightarrow, \leq)$ is ideally effective, we can compute intersections of upward- or downward-closed 
%\alain{non définis}
 subsets.
Hence we can compute the intersection of
% $\uparrow \{b_1,b_2,...,b_m\}$
$\Bad$
and
$S \setminus \pred^*(\Safe)$,
which are both upward-closed.
Since
% $\uparrow \{b_1,b_2,...,b_m\} \subseteq J_1 \cup J_2 \cup \cdots \cup J_n$
$\Bad \subseteq \pred^*(\Safe)$
can be reformulated as
$\Bad \cap (S \setminus \pred^*(\Safe)) = \emptyset$
the resilience problem is decidable.
\end{proof}

\begin{corollary}
The resilience problem is decidable for ideal-effective downward-compatible WSTS with 
$\Safe=\downarrow \Safe$
and $\Bad=\uparrow \Bad$.
\end{corollary}

\begin{proof}
Downward compatibility of $\mathscr{S}=(S,\rightarrow, \leq)$ 
means that
for all $s_1, s_2, t_1 \in S$ with
$s_2 \leq s_1$ and $s_1 \to t_1$
there
exists $t_2 \in S$ with
$t_2 \leq t_1$ and $s_2 \to^* t_2$.

Let $D$ be a downward-closed subset of $S$
and let $x \in \downarrow \pred^*(D)$.
By downward closure, there exists
$y \in \pred^*(D)$ 
such that $x \leq y$.
By definition of $\pred^*(D)$ then there exists 
$d \in D$, $m\geq 0$ and $(a_i)_{0 \leq i \leq m+1} \in S^{m+2}$ such that
$y = a_0 \to a_1 \to a_2 \to \cdots \to a_m \to a_{m+1} = d$.

By downward compatibility $a_0 \to a_1$
implies that there exists $a'_1 \in S$ such that $a'_1 \leq a_1$ and
$x \to^* a'_1$.
More generally $a_i \to a_{i+1}$ and
$a'_i\leq a_i$ implies the existence of $a'_{i+1} \in S$ with $a'_{i+1} \leq a_{i+1}$ and
$a'_i \to^* a'_{i+1}$,
and, by induction,
 $x \to^* a'_1 \to^* \cdots \to^* a'_{m} \to^* a'_{m+1} = d'$
with $d' \leq d$.
Since
$d'$ 
% \alain{qui appartient à qui ?}
belongs to $D$ by downward closure of $D$, $x \in \pred^*(D)$.
\end{proof}

% \begin{proposition}
In the case
of a ideal-effective WSTS 
where
the additional hypothesis that
for all downward-closed set $D \subseteq S$, the set $\pred^*(D)$ is downward-closed
is not met,
the above construction
can provide a proof
of non-resilience
i.e. when
$\Bad \cap (S \setminus \downarrow\pred^*(\Safe)) \neq \emptyset$
then
$\Bad \not\subseteq \downarrow\pred^*(\Safe)$
and hence
$\Bad \not\subseteq \pred^*(\Safe)$.
When $\Bad \cap (S \setminus \downarrow\pred^*(\Safe)) = \emptyset$
however
it is not enough to conclude.



\subsubsection{Case: $\Safe=\uparrow \Safe$.}

% \alain{2 clos par le haut ont une intersection non vide....}

Since $\Bad \cap \Safe = \emptyset$, the subcase $\Safe = \uparrow \Safe$ and $\Bad = \uparrow \Bad$ leads to a contradiction since two upward closed sets have not an empty intersection. We then consider the case where $\Bad$ is as upward-closed
as it can be without intersecting with $\Safe$,
i.e. 
such that there exists an upward-closed set $U$
such that $\Bad = U \setminus \Safe$.

\iffalse
\alain{à quoi ça sert ici ?: quelle signification ?Decidability of $U$ and $\Safe$ imply the decidability of $\Bad$.}
\mathieu{Pas convaincu que ça serve, je vais enlever}
% hop
\fi

example: ?


\begin{theorem}\label{up-up}
The resilience problem is decidable for effective WSTS with effective pred-basis, $\Safe=\uparrow \Safe$
and $\Bad= U \setminus \Safe$ with $U = \uparrow U$.
\end{theorem}


\begin{proof}
Since $\Safe=\uparrow \Safe$ is upward closed, there exists a finite basis $B_{ \Safe}$ such that $\uparrow \Safe = \uparrow B_{\Safe}$. 
Moreover since $\mathscr{S}=(S,\rightarrow,\leq)$ is a WSTS,  $\pred^*(\Safe)=\uparrow \pred^*(\Safe)$ and $\pred^*(\Safe)$ admits a finite basis $B_{\pred^*(\Safe)}$. Since $\mathscr{S}=(S,\rightarrow,\leq)$ is a WSTS  with effective pred-basis, we may compute a finite basis of $\pred^*(\Safe)$ with the backward coverability algorithm. 
Since $U$  is upward closed, there exists a finite basis $B_{U}$ such that $U = \uparrow B_{U}$. % Moreover $ \uparrow B_{\Bad} \subseteq \uparrow B_{\pred^*(\Safe)}$ iff for every $b \in B_{\Bad}$, there is a $s \in B_{\pred^*(\Safe)}$ such that $s \leq b$.
Since $\Bad = U \setminus \Safe$, $\Bad \subseteq \uparrow B_{\pred^*(\Safe)}$ iff for every $b \in B_{U}$, there is either $s \in B_{\pred^*(\Safe)}$ such that $s \leq b$, either $t \in B_{\Safe}$ such that $t\leq b$,
% si on est dans up Bad, il faut que ou bien on soit dans pred(Safe) ou bien on soit dans Safe
hence the resilience problem is decidable.
\end{proof}

\begin{proposition}
In WSTS with strong compatibility and effective pred-basis,  $\Safe=\uparrow \Safe$, the bounded resilience problem is equivalent to the resilience problem.
\end{proposition}

\begin{proof}
Since $\Safe=\uparrow \Safe$ and
$\mathscr{S}=(S,\rightarrow,\leq)$ is a WSTS with strong %upward-
compatibility, then $\pred^{\leq n}(\Safe)= \uparrow~\pred^{\leq n}(\Safe)$ for all $n \in \N$,
% \alain{$\pred^n$ ou $\pred^{\leq n}$ ? même question pour post. et où est-ce défini ?}
and there exists $n_0 \in \N$ such that 
$\pred^{\leq n_0}(\Safe) = \uparrow \pred^{\leq n_0}(\Safe) = \uparrow \pred^*(\Safe) = \pred^*(\Safe)$.
Hence the equivalence.
\end{proof}

\begin{corollary}\label{B-up-up}
The bounded resilience problem is decidable for WSTS with effective pred-basis,
strong compatibility
 $\Safe=\uparrow \Safe$
and $\Bad=U \setminus \Safe$ with $U = \uparrow U$.
\end{corollary}


\begin{theorem}\label{k-up-up}
The % three %uniform 
$k$-resilience problem is decidable for WSTS with effective pred-basis, strong %upward-
compatibility, $\Safe=\uparrow \Safe$
and $\Bad=U \setminus \Safe$  with $U = \uparrow U$.
%	and \Bad is upward closed or downward closed.
\end{theorem}

\begin{proof}
Since $\Safe=\uparrow \Safe$ is upward-closed, there exists a finite basis $B_{ \Safe}$ such that $\uparrow \Safe = \uparrow B_{\Safe}$. 
Moreover since $\mathscr{S}=(S,\rightarrow,\leq)$ is a WSTS with strong (upward) compatibility,  $\pred^{\leq n}(\Safe)=\uparrow \pred^{\leq n}(\Safe)$ for all $n\in \N$ and $\pred^{\leq k}(\Safe)$ admits a finite basis $B_{\pred^{\leq k}(\Safe)}$. % Since $\mathscr{S}=(S,\rightarrow,\leq)$ is a WSTS  with effective pred-basis, we may compute a finite basis of $\pred^{\leq k}(\Safe)$ with the backward coverability algorithm. 
Since $U$  is upward-closed, there exists a finite basis $B_{U}$ such that $U = \uparrow B_{U}$. % Moreover $ \uparrow B_{\Bad} \subseteq \uparrow B_{\pred^{\leq k}(\Safe)}$ iff for every $b \in B_{\Bad}$, there is a $s \in B_{\pred^*(\Safe)}$ such that $s \leq b$.
Since $\Bad = U \setminus \Safe$, $\Bad \subseteq \uparrow B_{\pred^{\leq k}(\Safe)}$ iff for every $b \in B_{U}$, there is either $s \in B_{\pred^{\leq k}(\Safe)}$ such that $s \leq b$, either $t \in B_{\Safe}$ such that $t\leq b$,
% si on est dans up Bad, il faut que ou bien on soit dans pred(Safe) ou bien on soit dans Safe
hence the resilience problem is decidable.
\end{proof}








