

\newcommand{\Bad}{\textsf{Bad}}
\newcommand{\Safe}{\textsf{Safe}}


\newcommand{\pred}{\textsf{pred}}
\newcommand{\post}{\textsf{post}}
% \renewcommand{\succ}{\textsf{Succ}}

\section{Well-structured transition systems}\label{section definitions}



%   In this section, we introduce general notations and preliminary definitions.

The model we are interested in is labeled WSTS (and later some particular instances, i.e. Timed/Counter Automata for instance).


% \textcolor{red}{Before defining WSTS, need a definition of TS and WQO}

\noindent
{\bf Transition systems}


\begin{definition}
 A {\em transition system} is a pair $\mathscr{S} = (S,\rightarrow )$ where $S$ is a set of 
 {\em states} and  
 $ {\rightarrow} \subseteq S \times S$ is a
 binary relation 
 on
 the set of states, denoted as the set of {\em transitions}. 

\iffalse
\mathieu{ Maybe add this back ?
A {\em labeled transition system} (LTS for short) is a tuple $\mathscr{S}=(S, \Sigma, \rightarrow)$ where 
$S$ is a set of {\em states}, $\Sigma$ is a (finite) set of {\em labels}, and 
${\rightarrow} \subseteq S\times \Sigma \times S$ is a 
ternary relation,
denoted as the set of {\em labeled transitions}. }
\fi
\end{definition}

% We prefer to use infix notation and $(s,a ,s')\in {\rightarrow} $ will be abbreviated as    $s  \xrightarrow{a}  s'$ to represent a transition from configuration $s$ to configuration $s'$ with label $a$. 
We prefer to use infix notation and write $s \rightarrow s'$ to denote a {\em transition} from state $s$ to state $s'$ (i.e., $ (s,s') \in  {\rightarrow} $).
We write $\rightarrow^{k}$, $\rightarrow^{+}$, $\rightarrow^{=}$, $\rightarrow^{*}$
for the $k$-step iteration of $\rightarrow$, its transitive closure, its reflexive closure, its reflexive and transitive closure.
Let $X,Y \subseteq S$ and $k \in \mathbb{N}$. We denote $X \longrightarrow^{*} Y$ (resp. $X \longrightarrow^{\leq k} Y$) if from all states $x \in X$ there exists a path (resp. of length smaller than $k$) that reaches a state $y \in Y$.
\noindent
The set of {\em (immediate) successors} of a state $s \in S$ is defined as 
 $\post(s) = \{ s' \in S \mid  ~ s \xrightarrow{} s'\}$. 
% $\post(s) = \{ s' \in S \mid  ~ \exists a \in \Sigma~ s \xrightarrow{a} s'\}$. 
A state without successors is called a {\em dead end}. 
The set of {\em (immediate) predecessors} of a state $s \in S$ is deﬁned as
 $\pred(s) = \{ s' \in S \mid  ~ s' \xrightarrow{} s\}$. 
% $\pred(s) = \{ s' \in S \mid  ~ \exists a \in \Sigma~ s' \xrightarrow{a} s\}$. 
By iterating $\pred$ and $\post$ we obtain  
$\post^n(s) = \{ s' \in S \mid  ~ s' \xrightarrow{}^n s\}$
and
$\pred^n(s) = \{ s' \in S \mid  ~ s' \xrightarrow{}^n s\}$.
However, we are generally more interested in
$\post^{\leq n}(s) = \bigcup_{1 \leq i \leq n} \post^i(s)$, $\post^*(s)= \bigcup_{1 \leq i} \post^i(s)$
and
$\pred^{\leq n}(s) = \bigcup_{1 \leq i \leq n} \pred^i(s)$ and $\pred^*(s) = \bigcup_{1 \leq i} \pred^i(s)$. % \\


The {\em reachability problem} asks, given a transition system $\mathscr{S} = (S, \to)$, two configurations $s, t \in S$, whether $s \to^* t$. It can be reformulated as asking whether 
$s \in \pred^*(t)$ or asking whether $t \in \post^*(s)$. \\

	\iffalse
\problemx{Reachability}
{A transition system $\mathscr{S} = (S, \to)$, two configurations $s, t \in S$}
{$s \to^* t$? \\}
	\fi

%

\noindent
{\bf Well-quasi-orderings}

A {\em quasi-ordering} (a qo) is any reflexive and transitive relation $\leq$ over some set $X$ and we often write $(X,\leq)$.

We abbreviate $x \leq y \not\leq x$ by $x < y$.
% A partial ordering (a po) is an antisymmetric qo
	% \alain{
Any qo induces an equivalence relation ($x \equiv y$ iff $x \leq y \leq x$).
	% }
% and gives rise to a po between the equivalence classes ?
% 	do we need po ?

We now recall a few results from the theory of well-orderings (add reference [...]).


\begin{definition}
 A {\em well-quasi-ordering} (wqo) is any quasi-ordering $(X,\leq)$ such that, for any infinite sequence $x_0, x_1, x_2, ...$ in $X$, there exist indexes $i \leq j$ with $x_i \leq  x_j$.
\end{definition}


There exists a stronger formulation. $(X,\leq)$ is a wqo iff any infinite sequence  $x_0, x_1, x_2, ...$ in $X$ contains an infinite increasing subsequence: $x_{i_0} \leq x_{i_1} \leq x_{i_2} \cdots$ (with $i_0 < i_1 < i_2 \cdots$).

% \textcolor{red}{Add lemma about infinite increasing subsequences ?}
%
\iffalse
%
\begin{lemma}
(Erd\"os and Rado). Assume $\leq$ is a wqo. Then any infinite sequence contains an infinite increasing subsequence: $x_{i_0} \leq x_{i_1} \leq x_{i_2} \cdots$ (with $i_0 < i_1 < i_2 \cdots$).
\end{lemma}


\begin{proof}
Consider an infinite sequence and the set $M = \{i \in N \mid \forall j > i ~ x_i \not\leq x_j \}$. $M$ cannot
be infinite, otherwise it would lead to an infinite subsequence contradicting the wqo
hypothesis. Thus, $M$ is bounded and any $x_i$ with $i$ beyond $M$ can start an infinite
increasing subsequence.
\end{proof}
%
\fi
%

Given $(X,\leq)$ a quasi-ordering, an {\em upward-closed set} is any set $U \subseteq X$ such that if $y \geq x$ and $x \in U$ then $y \in U $.
A {\em downward-closed set} is any set $D \subseteq X$ such that if $y \leq x$ and $x \in D$ then $y \in D $. 
It is an {\em ideal } if it is also {\em directed}, i.e. it is nonempty and for every $a,b \in D$, there exists $c \in D$ such that $a \leq c$ and $b \leq c$.
To any subset $A \subseteq X$, we may associate
its {\em upward-closure},
 $\uparrow A = \{x \in X \mid \exists a \in A ~ y \geq a\}$
 and its 
 {\em downward-closure},
 $\downarrow A = \{x \in X \mid \exists a \in A ~ y \leq a\}$. 
We abbreviate $\uparrow \{x\}$ (resp. $\downarrow \{x\}$)
as $\uparrow x$ (resp. $\downarrow x$).


A {\em basis} of an upward-closed set $I$ is a set $I_b$ such that $I = \uparrow I_b$. 
% Higman investigated ordered sets with the finite basis property.

Wqo admits many other equivalent formulations. For instance: 
$(X,\leq)$ is a wqo if and only if any infinite increasing sequence $U_0 \subseteq U_1 \subseteq U_2 \subseteq \cdots$ of
upward-closed subsets in $X$ eventually stabilizes, 
%      i.e. there is a $k \in N$ such that $U_k = U_{k+1} = U_{k+2} = \cdots $ 
if and only if any upward-closed subset $U \subseteq X$ has a
finite basis if and only if $(X,\leq)$ is well-founded (i.e. it admits no infinite strictly decreasing sequence) and $X$ don't contain infinite subset of mutually incomparable elements (antichains).
%
\iffalse
%

\begin{lemma}{(Higman [40])} 
If $\leq$ is a wqo then any upward-closed $I$ has a
finite basis.
\end{lemma}

% \textcolor{red}{Expliquer ce que c'est une base d'abords.}

\begin{proof}
The set of minimal elements of $I$ is a basis because $\leq$ is well-founded. It
only contains a finite number of non-equivalent elements otherwise they would make
an infinite sequence contradicting the wqo assumption.
\end{proof}



\begin{lemma}  \label{upward-closed stablizes}
If $\leq$ is a wqo then any infinite increasing sequence $I_0 \subseteq I_1 \subseteq I_2 \subseteq \cdots$ of
upward-closed sets eventually stabilizes, i.e. there is a $k \in N$ such that 
$I_k = I_{k+1} = I_{k+2} = \cdots $.
\end{lemma}

\begin{proof}
Assue we have a counter-example.
We extract an infinite subsequence where
inclusion is strict: $I_{n_0} \subsetneq I_{n_1} \subsetneq I_{n_2} \cdots$. Now, for any $i>0$, we can pick some $x_i \in I_{n_i} \setminus I_{n_{i-1}}$. The well-quasi-ordering hypothesis means that the infinite sequence of $x_i$'s
contains an increasing pair $x_i \leq x_j$ for some $i<j$. Because $x_i$ belongs to an upward-
closed set $I_{n_i}$ we have $x_j \in I_{n_i} $, contradicting $x_j \not\in I_{n_{ j - 1}}$.
\end{proof}
%
\fi
%

Quasi-orderings that have no infinite antichains enjoy a similar \emph{finite decomposition} property than wqo. In such \emph{Finite Antichains} sets $(X,\leq)$, every downward closed subset $D \subseteq X$ can be decomposed into a \emph{finite} set of ideals $J_1, J_2,..., J_n$ (an ideal is a directed downward closed subset) such that $D = \downarrow (J_1 \cup J_2 \cup..\cup J_n)$.

In what follows, a downward closed set $D$ is represented by its finite set of ideals (or by the minimal elements of its upward-closed complement).
%		$D=\downarrow D$   $I_D=\{J_1, J_2,...,J_n\}$ 		satisfying $D = \downarrow (J_1 \cup J_2 \cup..\cup J_n)$ 
and an upward closed set $U$ is represented by its finite set of minimal elements. \\
% $M_U$ of its  satisfying $U=\uparrow M_U$.



\noindent
{\bf Well-structured transition systems}


\begin{definition}\cite{DBLP:journals/iandc/Finkel90,DBLP:journals/tcs/FinkelS01}
A {\em well-structured transition system} (WSTS)  $\mathscr{S}=(S, \rightarrow, \leq)$
is a transition system $(S, \rightarrow)$
equipped with a wqo ${\leq} \subseteq S \times S$ such that  
%  decidable ≤  wqo on S, i.e., for each two given states s, s ′ ∈ S, it is decidable whether s ≤ s ′ . 
the transition relation $ \rightarrow$ is (upward) compatible with $\leq$, i.e., for all 
$s_1, t_1 , s_2 \in S$
	with $s_1 \leq s_2$  and $s_1 \rightarrow t_1$, there exists 
	$t_2 \in S$ with 
	$t_1 \leq t_2$ and $s_2 \rightarrow^{*} t_2$.
\end{definition}

We say that a WSTS $\mathscr{S}$ has the \emph{strong (upward) compatibility} when moreover for all 
$s_1, t_1 , s_2 \in S$
	with $s_1 \leq s_2$  and $s_1 \rightarrow t_1$, there exists 
	$t_2 \in S$ with 
	$t_1 \leq t_2$ and $s_2 \rightarrow t_2$.

Several families of formal models of processes give rise to WSTSs in a natural way, e.g. Petri nets when inclusion between markings is used as the well-ordering and lossy channel systems with the subword ordering.


% \textcolor{red}{Define 'has effective pred-basis'. Maybe it should be included in WSTS definition, maybe it can be another def. I kind of like the idea of 'effective pred-basis' and 'decidable $\leq$' being independant from the WSTS definition}
\iffalse
\begin{proposition}\cite{DBLP:journals/tcs/FinkelS01}
If $\mathscr{S}$ is an WSTS and $U \subseteq S$ is an upward-closed set of states, then $\pred^*(U )$ is upward-
closed.
\end{proposition}
%
Proof. Assume $s \in \pred^* (U )$. Then $s \rightarrow^* t$ for some $t \in U $. If now $s' \geq s$ then upward-compatibility entails that $s' \rightarrow^* t'$ for some $t' \geq t$. Then $t' \in U$ and $s' \in \pred^*(U )$.
\fi





A WSTS $\mathscr{S}=(S, \rightarrow, \leq)$ is {\em effective} if there exists a pair of Turing machines
($M_\rightarrow$, $M_\leq$) operating on $\N \times \N$ such that
$ M_\rightarrow$ computes the transition relation “$\rightarrow$” and 
$M_\leq$ the ordering relation “$\leq$”. 
We say that $\mathscr{S}$ is {\em post-effective} if it is effective, and if there
exists an additional Turing machine that computes $|\post(x)| \in \N \cup \{\infty\}$ 
on input $x$,
with $x \in X_i $. 
Such a Turing machine, in combination with $M_\rightarrow$, allows computing
$\post(x)$ whenever the latter is finite. We say that $\mathscr{S}$ is {\em upward pre-effective} if it is effective,
and if there exists an additional Turing machine that computes a finite basis of 
$\uparrow \pred (\uparrow x)$
on input $x$, where $x$ is a state of $\mathscr{S}$. 
We say that $\mathscr{S}$
is {\em ideally effective} if
\begin{itemize}
\item the function mapping the encoding of a configuration $s$
to the encoding of the ideal $\downarrow s$ is computable;
\item inclusion of ideals is decidable;
\item the downward closure $\downarrow \post(I)$ expressed as a finite union of ideals is computable from the ideal $I$.
\end{itemize}

\iffalse
\alain{pas ici}
\begin{definition}{\cite{BFM-ic17}} 
A class $C$ of WSTS is {\em ideally effective} if
\begin{itemize}
\item the function mapping the encoding of a configuration $s$ of a WSTS
to the encoding of the ideal $\downarrow s$ is computable;
\item inclusion of ideals is decidable;
\item the downward closure $\downarrow \post(I)$ expressed as a finite union of ideals is computable from the ideal $I$.
\end{itemize}
\end{definition}

\fi



We will use the following property: if $\mathscr{S}$ is a WSTS with strong compatibility and $U \subseteq S$ is upward-closed, then $\pred(U )$, $\pred^k(U )$ with $k\geq0$, and $\pred^*(U )$ are upward-closed \cite{DBLP:journals/tcs/FinkelS01}.
%\alain{étrange ces deux propositions, l'une suffirait}
\iffalse
Proof. Assume $s \in \pred (I )$. Then $s \rightarrow t$ for some $t \in I $. If now $s' \geq s$ then strong upward-compatibility entails that $s' \rightarrow t'$ for some $t' \geq t$. Then $t' \in I$ and $s' \in \pred(I )$.
\fi
%
Now, we recall a simple condition that insures that a finite basis of $\pred^*(\uparrow s )$ is computable for every $s \in S$.

\begin{definition}\cite{DBLP:journals/tcs/FinkelS01,DBLP:journals/iandc/AbdullaCJT00}
A WSTS $\mathscr{S}=(S, \rightarrow, \leq)$ has {\em effective pred-basis} if there exists an algorithm accepting
any state $s \in S$ and returning $pb(s)$, a finite basis of $\uparrow \pred(\uparrow s)$.
\end{definition}

With the effective pred-basis hypothese, we obtain:

\begin{theorem}(ref)
A finite basis of $ \pred^*(U)$ is computable for any effective WSTS $\mathscr{S}=(S, \rightarrow, \leq)$ with effective pred-basis and any upward-closed set $U \subseteq S$ given with its finite basis $B_U$.
\end{theorem}





%         A downard-closed set $D$ is {\em decidable} if, given $s \in S$, it is decidable whether
%         $s \in D$. 

%\textcolor{red}{Since a downward-closed set does not have an ``upward-basis'' in general, we will demand that membership is decidable.}
% \textcolor{red}{Do we still demand this ?}
%\mathieu{On peut enlever ce point de discussion ici et en discuter de manière plus complête au moment où on discute de SAFE et BAD plus en détail je pense.}


%
\iffalse
%
\begin{claim}{(stability of upward-closed sets)}
Let $U, V \subseteq S$ be upward-closed. Then the sets $U \cup V$, and $U \cap V$ are upward-closed.
\end{claim}
%
\fi
%

% \begin{claim}
% Given a finite set $A \subseteq S$ with $I =\uparrow A$, we can compute a finite basis $B$ of $I$.
% \end{claim}

%			\begin{fact}\label{fact basis}
% Fact 3 ([1]). 
% Parosh Aziz Abdulla, Karlis Cerans, Bengt Jonsson & Yih-Kuen Tsay (1996): General Decidability Theorems for Infinite-State Systems. In: Proc. LICS 1996, IEEE Computer Society Press, pp. 313–321,

%For every upward-closed set $U \subseteq S$, there exists a finite basis $B$ of $U$. 

% (ii) Given a finite set $A \subseteq S$ with $I =\uparrow A$, we can compute a finite basis $B$ of $I$.
% \alain{(ii) est bizarre car A est déjà une base finie de $\uparrow A$, et $\min(A)$ est la base minimale}
%			\end{fact}
For a WSTS $\mathscr{S}=(S, \rightarrow, \leq)$ and an upward-closed set $U  \subseteq S$, let us study the convergence of the sequence defined by $U_0=U$ and $U_k= U_{k-1} \cup \pred(U_{k-1})$ for $k \geq 1$. When $\mathscr{S}$ has the strong compatibility, the sets $U_k$ are upward-closed and $U_k \subseteq U_{k+1}$ so we know that the sequence $(U_k)_k$ converges. Let us define the \emph{index} of convergence of the sequence $U_k$ as the smallest $k_0$ s.t. $U_k = U_{k_0}$ for all $k \geq k_0$. We may compute $k_0$ and we then have:  $\pred^*(U) = U_{k_0}$. \\
%

\noindent
\subsection{Computing the maximal $X$-live subsystem}

Let $\mathscr{S}=(S, \rightarrow, \leq,s_0)$ be WSTS with initial state $s_0$ and $X \subseteq S$ be an upward-closed set given by its finite minimal basis $B_X$. We say that $\mathscr{S}=(S, \rightarrow, \leq,s_0)$ is $X$-live if from any reachable state $s \in \post^*(s_0)$, $s \xrightarrow{*} X$ is satisfied.  We may verify that  $\mathscr{S}=(S, \rightarrow, \leq,s_0)$ is $X$-live iff  $\mathscr{S}=(S, \rightarrow, \leq,s_0)$ is $\pred^*(X)$-live. The \emph{maximal $X$-live subsystem} of $(S,\rightarrow,\leq,s_0)$ is ....

Let us remark that given a WSTS $\mathscr{S}=(S, \rightarrow, \leq,s_0)$, one may construct many \emph{guard} systems where every transition $s \rightarrow s'$ of $\mathscr{S}$ is guarded by a (monotone) formula $\phi$ defined by the grammar $\phi ::= s \geq u \mid s' \geq u \mid \phi \vee \phi \mid \phi \wedge \phi$ where $u \in S$. Since guards restrict the original runs but don't create new ones, every guarded transition system $\mathscr{S'}$ is a subsystem of $\mathscr{S}$. Since these formula are upward-compatible, the guarded transition systems $\mathscr{S'}=(S, \rightarrow', \leq,s_0)$ are still WSTS.
%
For example, VASS allows such guards.
  %	\lor s' \geq x_2  	\lor...	\lor s' \geq x_p$ (facile dans les VASS et modèles habituels).

\begin{theorem}{}
Given an effective WSTS with effective pred-basis and an upward-closed set $X$, the maximal $X$-live subsystem is a computable WSTS.
\end{theorem}

\begin{proof}
Since $X \subseteq S$ is upward-closed and $\mathscr{S}=(S, \rightarrow, \leq,s_0)$ is an effective WSTS with effective pred-basis, we compute the minimal basis of $\pred^*(X)=\{x_1,x_2,...,x_p\}$. 
%
%
Then we add the following guard $s' \geq x_1  	\vee s' \geq x_2  	\vee...	\vee s' \geq x_p$ to every transition $s \rightarrow s'$ of $\mathscr{S}$ and we define  $s \rightarrow' s'$ as $(s' \geq x_1  	\vee s' \geq x_2  	\vee...	\vee s' \geq x_p) \wedge s \rightarrow s'$ ; this insures that the new (guarded) WSTS $\mathscr{S'}=(S, \rightarrow', \leq,s_0)$ is $\pred^*(X)$-live and then it is also the maximal $X$-live sub-WSTS of $\mathscr{S}=(S, \rightarrow, \leq,s_0)$.

%		l'état atteint $s'$ est au dessus des minimaux de $\pred^*(X)$, ainsi par (upward) compatibility on sera toujours capable d'aller dans $X$. 
\end{proof}
%
%
%\noindent
%{\bf Vector addition system with states}

% Définir VASS

Let us recall that a {\em vector addition system with states (VASS)} in dimension $d$ ($d$-VASS for short) is a finite $\mathds{Z}^d$-labeled directed graph $V = (Q,T)$, where $Q$ is the set of {\em control-states}, and where $T \subseteq Q \times \mathds{Z}^d \times Q$ is the set of {\em control-transitions}. 
% The {\em size} of $V$ is defined as $|V|=|Q|+|T|*d*|log(||T||)$ where $||T||$ denotes the absolue value of the largest number that appears in $T$, i.e. $||T|| = max\{ ||\textbf{z}||: (p,\textbf{z},q) \in T\}$.

Subsetquently, $Q \times \N^d$ is the set of configurations of $V$.
For every configuration $p(\textbf{u}), q(\textbf{v}) \in Q \times \N^d$ and every control-transition $t = (p, \textbf{z}, q)$ we write $p(\textbf{u}) \xrightarrow{t} q(\textbf{v})$ whenever $\textbf{v} = \textbf{u} + \textbf{z} \geq \textbf{0}$
%
\iffalse \mathieu{Defining it like this makes it a LTS rather than a unlabeled TS - maybe talk about how we can 'forget' the labels to obtain an unlabeled TS ?}
\alain{les VASS ne sont pas vraiment étiquetés, sauf si on veut le faire, car on peut dire que les VASS sont définis à partir d'un nombre fini de control-transitions  $t = (p, \textbf{z}, q)$ générant une infinité de transtions notées $p(\textbf{u}) \xrightarrow{t} q(\textbf{v})$ puisque pour tout s, $p(\textbf{u+s}) \xrightarrow{t} q(\textbf{v+s})$} \fi
When in the context of a $d$-VASS, we denote $0^d$ by $\textbf{0}$.


Pour les VASS, je crois qu'on a une borne (2-exp) à la taille de $\pred^*(X)$ et à la taille de ses éléments \cite{DBLP:conf/rp/BozzelliG11} et c'est directement implémentable, donc en particulier, pour tout VASS, il existe un autre VASS de taille 2-exp plus grand qui a le plus grand sous-comportement restant dans $X$ .
Je crois que ça résoud aussi un pb résolu dans Valk et Jantzen 1985 \cite{DBLP:journals/acta/ValkJ85} mais en utilisant le graphe de karp et Miller donc avec complexité ackerman.... Dans ce cas, ça permettrait de résoudre autrement les premiers des 4 pbs dans \cite{DBLP:journals/acta/ValkJ85} avec une complexité 2-exp plutôt qu'ackerman. problèmes: marquage T-bloqué, dead, T-continual ?.

\begin{theorem}{}
Given a VASS and $X$ upward-closed, the maximal $X$-live subsystem is a computable VASS of size 2-exp.
\end{theorem}

applications to many upward-closed sets $X$:
$m$ is $\hat{T}$-blocked if no $t \in \hat{T}$ is fireable in $\post^*(m)$.
$m$ is dead if the reachability tree from $m$ is finite.
$m$ is bounded if the reachability set from $m$ is finite.
$m$ is $\hat{T}$-continual if there is an unfinite run from $m$ such that all transitions in $\hat{T}$ appear infinitely often.


\iffalse
\alain{ me semble maintenant inutile
%
\begin{definition}{ (index)}. 
If $\mathscr{S}$ is a WSTS with strong compatibility and $U \subseteq S$  is upward-closed and $k \geq 0$, let $U_k= \bigcup_{0 \leq n \leq k} \pred^n(U)$.
The {\em index} $k(U)$ is the
smallest $k_0$ s.t. $U_k = U_{k_0}$ for all $k \geq k_0$.
\end{definition}
%
%
If $\mathscr{S}$ is a WSTS with strong compatibility and $U \subseteq S$ is an upward-closed set, the sets $\pred(U )$, and $\pred^{\geq k}(U )$ for
every $k \geq 0$ are upward-closed, thus Lemma~\ref{upward-closed stablizes} ensures the existence of $k(U)$.
%
\begin{remark}
$U^{k+1} $ can be rewritten $U^{k+1}= \bigcup_{0 \leq j \leq k+1} \pred^j(U) = 
U \cup \bigcup_{1 \leq j \leq k+1} \pred^j(U) =
U \cup \pred(\bigcup_{0 \leq j \leq k} \pred^j(U))
=  U \cup \pred(U^k)$.
\end{remark}

This ensures the following.

\begin{fact}\label{stop condition}
% Fact 4 (stop condition). 
If $\mathscr{S}$ is a WSTS with strong compatibility and $U \subseteq S$ is an upward-closed set and $k \geq 0$ s.t. $U^k = U^{k+1}$ , then $U^\ell = U^k$ for all $\ell \geq k$, i.e.,
$k(U) \leq k$. This also implies that $\pred^*(U) = U^k$.
\end{fact}


\begin{lemma}
% Lemma 3 ([1]) 
% Parosh Aziz Abdulla, Karlis Cerans, Bengt Jonsson & Yih-Kuen Tsay (1996): General Decidability Theorems for Infinite-State Systems. In: Proc. LICS 1996, IEEE Computer Society Press, pp. 313–321,
 Given a basis of an upward-closed set $U \subseteq S$, and a state $s$ of an effective strongly WSTS, we can decide whether $U  \xrightarrow {*}{} s$.
%	we can reach $U$ from $s$.
\end{lemma}

\begin{proof}
We have to show that we can compute a basis of $U^{k+1}$ if we are given a basis of $U^k $. 
Then the
decidability of the stop condition follows directly. Let $B$ be a basis of $U^k$. 
We have
$$U^{k+1} = U \cup \pred(U^k ) = U \cup
\bigcup_{s' \in B}
\pred(\uparrow \{s' \}).$$

Since a finite basis of $\pred(\uparrow \{s' \}$) is computable for any $s'\in S$ by definition, we obtain a finite generating set of $U^{k+1}$ . By
Fact~\ref{fact basis}, we can compute a basis of $U^{k+1}$.
\end{proof}}


\fi






The two previous problems are well-known decidable.



