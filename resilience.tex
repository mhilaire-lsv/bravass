
\section{Resilience for WSTS}


\alain{pourquoi redire ça, c'est dans l'intro : In this section we introduce the concepts of resilience, bounded-resilience and $k$-resilience for well structured transition systems. We show that the resilience problems are decidable
for  completion-post-effective $\omega^2$-WSTS with strong compatibility
with $\Safe=\uparrow \Safe$,
and that resilience is decidable for downward-compatible ideal-effective WSTS
when $\Safe=\downarrow \Safe$. 
We show that the three resilience problems are however undecidable for WSTS with
strong compatibility in general.}


In a transition system $\mathscr{S}=(S,\rightarrow)$, we consider two subsets of states $\Safe, \Bad \subseteq S$ such that $\Safe \cap  \Bad = \emptyset$ and $\Safe ,  \Bad \neq \emptyset$.
%	The property of mutual exclusion is often modelised with $\Safe = \downarrow \Safe$.
The \emph{resilience problem} (resp. the \emph{$k$-resilience problem}) for $(\mathscr{S},\Safe,\Bad)$ is to decide whether from \emph{any} state in $\Bad$, \emph{there exists} a path (resp. a path of length smaller than or equal to $k$) that reaches a state in $\Safe$. We use the notation $\Bad \longrightarrow^{*} \Safe$ (resp. $\Bad \longrightarrow^{\leq k} \Safe$) for $\forall x \in \Bad, \exists y \in \Safe$ such that $x \longrightarrow^{*} y$ (resp.  $\forall x \in \Bad, \exists y \in \Safe$ such that $x \longrightarrow^{\leq k} y$). In our framework, $\Safe, \Bad \subseteq S$  are possibly infinite but they must admit a computable finite representation : for example, downward-closed sets and upward-closed sets in wqo and semilinear sets in $\mathbb{N}^d$ have finite representations. 





Let us formalize three resilience problems.


\problemx{resilience problem (RP)}
{A transition system $\mathscr{S}=(S,\rightarrow)$ and two sets $\Safe, \Bad \subseteq S$.}
{$\Bad \longrightarrow^{*} \Safe$ ?\newline}

% \alain{il faudrait ne pas répéter 3 fois les mêmes imputs pour les 3 pbs: énoncer les 3 uniformes pbs d'un coup avec une fois l'input puis les 3 pbs pour un état s donné sans répéter non plus 3 fois les mêmes inputs}


\problemx{$k$-resilience problem (kRP)}
{A transition system $\mathscr{S}=(S,\rightarrow), k \in \mathbb{N}$ and two sets $\Safe, \Bad \subseteq S$.}
{$\Bad \longrightarrow^{\leq k} \Safe$ ?\newline}

\problemx{bounded resilience problem (BRP)}
{A transition system $\mathscr{S}=(S,\rightarrow)$ and two sets $\Safe, \Bad \subseteq S$.}
%{$\exists k \geq 0 ~ \forall s' \in D ~ s \rightarrow^* s' \implies \exists s'' \in U ~ s' \rightarrow^{\leq k} s''$ ?\newline}
{$\exists k \geq 0$ such that $\mathscr{S}$ is %uniformely
 $k$-resilient ?\newline}


\iffalse

\problemx{Resilience problems}
{A transition system $\mathscr{S}=(S,\rightarrow)$, two sets $\Safe, \Bad \subseteq S$, $k \in \mathbb{N}$.}
{ ({\sc resilience problem (RP)}) $\Bad \longrightarrow^{*} \Safe$ ?\newline  
({\sc $k$-resilience problem (kRP)})		$\Bad \longrightarrow^{\leq k} \Safe$ ?\newline
({\sc bounded resilience problem (BRP)})	$\exists k \geq 0$ such that $\mathscr{S}$ is 
 $k$-resilient ?\newline}

\fi


In {\bf Flight Controller System}, the safe states correspond to the aircrafts having both landed, i.e.
$\Safe = \{(q_{A,1}, q_{M,i}, q_{B,1})(\textbf{v}) \mid \textbf{v} \in \N^4, i \in \N\}$,
and $\Bad$ is the complement of $\Safe$. 
% $\Bad = \{(q_{A,0}, q_{M,0}, q_{B,0})(\textbf{v}) \mid \textbf{v} \in \N^4\}$.
% wheher
The system is not $7$-resilient since there is no path of length smaller than $7$ from $(q_{A,0}, q_{M,5}, q_{B,0})(\textbf{v})$ to $\Safe$, but it is $8$-resilient.

\iffalse
\begin{example}
Let us consider a VASS with only one state $q$, one counter, and one transition that substracts $-1$ from the counter, with $\Safe = \downarrow q(0)$, $\Bad = \uparrow q(1)$,
then resilience hold but not bounded resilience: for every bound $k$ there is an element of $\Bad$ e.g. $q(k+1)$ which necessitate at least $k+1$ steps before it can reach $\Safe$. 
\end{example}
\fi


  
These three resilience problems are decidable for finite transition systems but undecidable for (general) infinite-state transition systems. So we restrict our framework to the class of infinite-state WSTS. Since most of decidable properties in WSTS rely on the computation of upward or downward-closed sets \cite{DBLP:journals/iandc/AbdullaCJT00, DBLP:journals/tcs/FinkelS01}, we consider upward-closed or downward-closed sets $\Safe$ and $\Bad$. In \cite{DBLP:journals/corr/abs-2108-00889}, the authors considered that $\Bad$ is downward-closed and $\Safe$ is upward-closed. %\mathieu{Remarquer que dans l'example~\ref{Example} on a à la fois upward closed ET downward closed pour $\Safe$ ET $\Bad$.} 
Remark that in {\bf Flight Controller System}, $\Safe$ and $\Bad$ are both upward-closed \emph{and} downward-closed.

Surprinsingly, we have not found decidability results about the resilience problems for WSTS.	
% We deduce decidability results for the four pairs of sets $\Safe$ and $\Bad$ downward-closed and upward-closed as seen in Section~\ref{synthesis}.
In particular, the existing proofs of resilience use the decidability of reachability;
\mathieu{quelles preuves ? pour quelle notion de résilience ?} but we wish to decide resilience for models with undecidable reachability.
Our result will rely on coverability instead of reachability. We moreover show undecidability when coverability is not decidable in the case $\Safe = \uparrow \Safe$
and in the general case when $\Safe = \downarrow \Safe$.
 





It is useful to note that in a sequence of states% of $S$
, every prefix is always 
either in the case that the latest visited $\Bad$ state has already been followed by a 
$\Safe$ state \-- and thus the latest state is contextually ``$\Safe$'' \--
or in the case that it still has to \-- and thus the latest state is contextually ``$\Bad$''. 
Thus, \emph{in context}, there is no true ``neutral'' state.
Hence we will consider in the following not only that $\Bad$ and $\Safe$ are disjoint but
% w.l.o.g.
	also
that $\Bad$ is the complement of $\Safe$,
in which case
if $\Bad$ is downward-closed then $\Safe$ is upward-closed and vice-versa.
Cases where $\Bad$ or $\Safe$ are not complements of each other, and share closure properties, i.e. are both downward-closed or both upward-closed,
have also been studied, 
see 
Appendix~\ref{case down down}
and
Appendix~\ref{case up up} for results.


{\bf Related problems.} 
Resilience and the home-space problem are also linked to the 
model-checking of basic reachability and safety formulae. 
In particular~\cite{DBLP:conf/rp/Schnoebelen10} shows that the ``from-all'' formula $\forall s \in X~ \exists t \in Y~ s \to^* t$
% which has been shown
is decidable for Lossy Counter Machine (LCM)
when $X$ and $Y$ are semi-linear sets.
Other decidable formulae include ``one-to-one'' ($\exists s \in  X ~ \exists t \in  Y ~ s \to^* 
 t$), and ``all-to-same'' ($\exists t \in  Y ~ \forall s \in  X ~ s \to^*  t$),
whereas ``one-to-all'' ($\exists s \in  X ~ \forall t \in  Y ~ s \to^*  t$), 
``all-to-all'' ($\forall s \in  X ~ \forall t \in  Y ~ s \to^*  t$)
  and ``to-all'' ($\forall t \in  Y  ~ \exists s \in  X ~ s \to^*  t$) are undecidable (again, for LCM). 
  
  
  
\input{resilience-safe-up}

\input{resilience-safe-down}


{\bf Synthesis of the main decidability results}\label{synthesis}
\begin{center}
\begin{tabular}{ | l | c | c | c | r |}
\hline   \ %& $\uparrow$~ $\uparrow$~ 
		& $\Safe = {\uparrow \Safe}$~ 
		 & $\Safe = {\downarrow \Safe}$~ 
		 %& $\downarrow$~ $\downarrow$~
 \\ \hline
   RP %& Decidable (Thm~\ref{up-up}) 
   	& Decidable (Thm~\ref{down-up})  
   		 & Decidable (Thm~\ref{up-down}) 
   	%	 & Undecidable (Thm~\ref{down-down})
    \\ \hline
   BRP %& Decidable (Corollary~\ref{B-up-up}) 
   &  Decidable (Thm~\ref{down-up}) 
   		 & ?? 
   	%	 & ??
    \\ \hline
      kRP %& Decidable (Thm~\ref{k-up-up}) 
      & Decidable (Thm~\ref{down-up}) 
      		& ?? 
      	%	& ??
       \\ \hline
 \end{tabular}
\end{center}


\subsection{Computing the maximal resilient subsystem}

We now briefly investigate the question to control a system (non-resilient for a set $Safe$) such that its controlled behavior is resilient for $Safe$.
%
Let $\mathscr{S}=(S, \rightarrow, \leq)$ be WSTS and $Safe \subseteq S$ be an upward-closed set given by its finite minimal basis $B_{Safe}$. 

\begin{definition}
We say that $\mathscr{S}=(S, \rightarrow, \leq)$ is $X$-resilient if $S  \xrightarrow{*} X$ is satisfied.  
\end{definition}

We may verify that  $\mathscr{S}=(S, \rightarrow, \leq)$ is $Safe$-resilient iff  $\mathscr{S}=(S, \rightarrow, \leq)$ is $\pred^*(Safe)$-resilient. The \emph{maximal $Safe$-resilient subsystem} of $\mathscr{S}=(S,\rightarrow,\leq)$ is defined as $\mathscr{S}_{Safe}=(S,\rightarrow_{Safe},\leq)$ where $\rightarrow_{Safe}$ is the largest restriction of $\rightarrow$ that insures that $\mathscr{S}_{Safe}$ is $Safe$-resilient.
%\alain{vérifier que la plus grande existe}
Let us remark that given a WSTS $\mathscr{S}=(S, \rightarrow, \leq)$, one may construct many \emph{guard} systems where every transition $s \rightarrow s'$ of $\mathscr{S}$ is guarded by a (monotone) formula $\phi$ defined by the grammar $\phi ::= s \geq u \mid s' \geq u \mid \phi \vee \phi \mid \phi \wedge \phi$ where $u \in S$. Since guards restrict the original runs but don't create new ones, every guarded transition system $\mathscr{S'}$ is a subsystem of $\mathscr{S}$. Since these formula are upward-compatible, the guarded transition systems $\mathscr{S'}=(S, \rightarrow', \leq)$ are still WSTS.
%
For example, VASS and most of concrete WSTS allow such guards.
  %	\lor s' \geq x_2  	\lor...	\lor s' \geq x_p$ (facile dans les VASS et modèles habituels).

\begin{theorem}{}
Given an effective WSTS with effective pred-basis and an upward-closed set $Safe$, the maximal resilient subsystem is a computable WSTS.
\end{theorem}

\begin{proof}
Since $Safe \subseteq S$ is upward-closed and $\mathscr{S}=(S, \rightarrow, \leq)$ is an effective WSTS with effective pred-basis, we compute the minimal basis of $\pred^*(Safe)=\{x_1,x_2,...,x_p\}$. 
%
%
Then we add the following guard $s' \geq x_1  	\vee s' \geq x_2  	\vee...	\vee s' \geq x_p$ to every transition $s \rightarrow s'$ of $\mathscr{S}$ and we define  $s \rightarrow' s'$ as $(s' \geq x_1  	\vee s' \geq x_2  	\vee...	\vee s' \geq x_p) \wedge s \rightarrow s'$ ; this insures that the new (guarded) WSTS $\mathscr{S'}=(S, \rightarrow', \leq,s_0)$ is $\pred^*(Safe)$-resilient and then it is also the maximal resilient sub-WSTS of $\mathscr{S}=(S, \rightarrow, \leq)$.
		\end{proof}
%
It is also possible to define $(s_0,Safe)$-resilient systems as satisfying $\post^*(s_0) \xrightarrow{*} Safe$.



