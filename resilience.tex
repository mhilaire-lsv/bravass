
%%%
\iffalse
%%%%
%%%%
\subsection{Defining resilience}


\subsubsection{Resilience for general transition systems}


We ask whether we can reach a state 
%which satisfies
in 
%
$\Safe$  in a reasonable amount of time whenever we reach a state 
% which satisfies
in
%
$\Bad$. 
From this we formulate two resilience problems. First consider the case where the recovery time
is bound by a given natural number $k \geq 0$, i.e., the \emph{explicit resilience problem} for TS.

\problemx{$k$-Resilience problem }
{a transition system $(S,\rightarrow)$, an integer $k$, a state $s \in S$, $\Safe, \Bad \subseteq S$ and $\Safe \cap \Bad = \emptyset$.}
{$\forall s' \in \Bad, ~ s \rightarrow^* s' \implies \exists s'' \in \Safe ~ s' \rightarrow^{\leq k} s''$ ?\newline}

If a system $S$ satisfies the explicit resilience property for an integer $k$, we say that $S$ is $k$-resilient.

% If we assume that the transition system yields infinite sequences of transitions, we can express the property to be evaluated in CTL by s |= AG(\Bad → 0≤ j≤k EX j \Safe). 

We can also ask whether there exists such a bound $k$ such that $S$ is $k$-resilient. We call this problem the \emph{bounded resilience problem}.

%
%\problemx{Bounded Resilience problem}
%{a transition system $(S,\rightarrow)$, a state $s \in S$, $\Safe, \Bad \subseteq S$ and $\Safe \cap \Bad = \emptyset$.}
%{$\exists k \geq 0 ~ \forall s' \in \Bad, ~ s \rightarrow^* s' \implies \exists s'' \in \Safe ~ s' \rightarrow^{\leq k} s''$ ?\newline}
%


\problemx{Bounded Resilience problem}
{a transition system $(S,\rightarrow)$, a state $s \in S$, $\Safe, \Bad \subseteq S$ and $\Safe \cap \Bad = \emptyset$.}
{$\exists k \geq 0  \mathscr{S}$ is $k$-resilient. ?\newline}
%%

%%%


pour $k,k'$ donnés, chercher si $\Safe_{max}$ et $\Bad_{max}$ ont un sens ? on peut faire l'union des \Safe, \Safe' et des \Bad, \Bad' prendre le max des k. Fixer k, chercher et calculer $\Safe_{max}$ et $\Bad_{max}$.

%
%\alain{dire juste que \Safe = upward closed et \Bad = downward closed.
%envisager les 3 autres cas. souvent \Bad = upward closed (par ex l'exclusion mutuelle).
%4 resilience problem (U,D), (U,U), (D,U), (D,D)}

\fi




\newcommand{\Bad}{\textsf{Bad}}
\newcommand{\Safe}{\textsf{Safe}}



\section{Resilience for WSTS}

In a transition system $\mathscr{S}=(S,\rightarrow)$, we consider two subsets of states $\Safe, \Bad \subseteq S$ such that $\Safe \cap  \Bad = \emptyset$.
%	The property of mutual exclusion is often modelised with $\Safe = \downarrow \Safe$.
The \emph{resilience problem} (resp. the \emph{$k$-resilience problem}) for $(\mathscr{S},\Safe,\Bad)$ is to decide whether from \emph{any} state in $\Bad$, \emph{there exists} a path (resp. a path of length smaller than or equal to $k$) that reaches a state in $\Safe$. We use the notation $\Bad \longrightarrow^{*} \Safe$ (resp. $\Bad \longrightarrow^{\leq k} \Safe$) for $\forall x \in \Bad, \exists y \in \Safe$ such that $x \longrightarrow^{*} y$ (resp.  $\forall x \in \Bad, \exists y \in \Safe$ such that $x \longrightarrow^{\leq k} y$). In our framework, $\Safe, \Bad \subseteq S$  are possibly infinite but they must admit a computable finite representation : for example, downward-closed sets and upward-closed sets in wqo and semilinear sets in $\mathbb{N}^d$ have finite representations. 
%	If $\Safe = S \backslash \Bad$, then $\Safe$ is downward-closed iff $\Bad$ is upward-closed. 
Let us formalize three resilience problems.

\problemx{resilience problem (RP)}
{A transition system $\mathscr{S}=(S,\rightarrow)$ and two sets $\Safe, \Bad \subseteq S$.}
{$\Bad \longrightarrow^{*} \Safe$ ?\newline}
%
%\alain{il faudrait ne pas répéter 3 fois les mêmes imputs pour les 3 pbs: énoncer les 3 uniformes pbs d'un coup avec une fois l'input puis les 3 pbs pour un état s donné sans répéter non plus 3 fois les mêmes inputs}

%We add a third problem that decides whether there exists an $k$ such  that the system is $k$-resilient.
%

\problemx{$k$-resilience problem (kRP)}
{A transition system $\mathscr{S}=(S,\rightarrow), k \in \mathbb{N}$ and two sets $\Safe, \Bad \subseteq S$.}
{$\Bad \longrightarrow^{\leq k} \Safe$ ?\newline}

\problemx{bounded resilience problem (BRP)}
{A transition system $\mathscr{S}=(S,\rightarrow)$ and two sets $\Safe, \Bad \subseteq S$.}
%{$\exists k \geq 0 ~ \forall s' \in D ~ s \rightarrow^* s' \implies \exists s'' \in U ~ s' \rightarrow^{\leq k} s''$ ?\newline}
{$\exists k \geq 0$ such that $\mathscr{S}$ is %uniformely
 $k$-resilient ?\newline}


\alain{dessous: à dire mais pas sous forme de proposition}
\begin{proposition}[Reformulation]\label{reformulation}
$\mathscr{S}=(S,\rightarrow,\leq)$ is %uniformely 
(\Bad,\Safe)-resilient iff $\Bad \subseteq \pred^*(\Safe)$.\\
$\mathscr{S}=(S,\rightarrow,\leq)$ is %uniformely 
(\Bad,\Safe)-$k$-resilient iff $\Bad \subseteq \pred^k(\Safe)$.
\end{proposition}

These three resilience problems are decidable for finite transition systems but undecidable for (general) infinite-state transition systems. So we restrict our framework to the class of infinite-state WSTS. Since most of decidable properties in WSTS rely on the computation of upward or downward closed sets \cite{DBLP:journals/iandc/AbdullaCJT00, DBLP:journals/tcs/FinkelS01}, we consider upward closed or downward closed sets $\Safe$ and $\Bad$.

For instance, the well-known mutual exclusion property is often modelized in a $d$-counters machine by the property that a counter $c_{mutex}$ must be bounded by (usually) one. Then, the set $\Safe =  \{c_{mutex} \leq 1\} \times \mathbb{N}^{d-1}$ is downward closed and $\Bad =\{c_{mutex} \geq 2\} \times  \mathbb{N}^{d-1} $ is the upward closed complementary of $\Safe$. 

In \cite{DBLP:conf/gg/Ozkan22}, the authors considered that $\Bad$ is downward closed and $\Safe$ is upward closed.
%		
RP is decidable for lossy counter machines (LCM) with $\Safe$ and $\Bad$ semilinear sets as a consequence of results in Section 3.4 of \cite{DBLP:conf/rp/Schnoebelen10}. We deduce that the three resilience problems are decidable for all four pairs of sets $\Safe$ and $\Bad$ downward closed and upward closed sets.

In particular, the existing proofs of resilience use the decidability of reachability; but we wish to decide resilience for models with undecidable reachability.
%

%	 and ideals are recursive 
\alain{???}.




\iffalse

\begin{proposition}\label{general}
\textcolor{red}{
$\mathscr{S}=(S,\rightarrow,\leq)$ is %uniformely 
(\Bad,\Safe)-bounded-resilient iff $\mathscr{S}=(S,\rightarrow,\leq)$ is %uniformely 
(\Bad,\Safe)-resilient (CONJECTURE FOR NOW)
}
\end{proposition}

\begin{proof}
Resilient means that ...
\end{proof}

\fi


\input{resilience-safe-up}

\input{resilience-safe-down}


\subsection{Case Synthesis}

% \mathieu{En rouge quand il s'agit de conjectures}



\begin{center}
\begin{tabular}{ | l | c | c | c | r |}
\hline   \Safe~\Bad & $\uparrow$~ $\uparrow$~ & $\uparrow$~ $\downarrow$~ & $\downarrow$~ $\uparrow$~ & $\downarrow$~ $\downarrow$~ \\ \hline
   RP & Decidable (Theorem~\ref{up-up}) & Decidable (Theorem~\ref{down-up})  & Decidable (Theorem~\ref{up-down}) & Undecidable (Theorem~\ref{down-down}) \\ \hline
   BRP & Decidable (Corollary~\ref{B-up-up}) &  Decidable (Theorem~\ref{down-up}) & ?? & ?? \\ \hline
      kRP & Decidable (Theorem~\ref{k-up-up}) & Decidable (Theorem~\ref{down-up}) & ?? & ?? \\ \hline
 \end{tabular}
\end{center}


\alain{trouver les \Bad~ et \Safe~ maximum tels que S est resilient. est-ce vrai que si S est $(B_i,D_i)$-resilient alors S est $(\cap, \cup B_i,D_i)$-resilient ?}
%
\alain{on peut penser à des ensembles $\Bad$ definis dans une logique booleennne sur les clos par le bas, haut, +...}


%We first assume that the safety property is given by an upward-closed set and the bad condition by a decidable downward-closed set. 
% \textcolor{red}{Seems like a reasonable assumption to me.}

%From these considerations, we formulate instances of the abstract resilience problems for well-
%structured transition systems.


