

\section{Reductions to reset-VASS}

Most of our undecidability results rely on reset-VASS, which are WSTS, and for which several problems are undecidable, including reachability~\cite{araki1976PN, dufourd1998reset}. This has consequences for {\sc Resilience}; for instance in the case $\Safe = \downarrow \Safe$, it is possible for $\Safe$ to be a singleton element. Even then, {\sc Resilience} (resp. {\sc State-resilience}) is not strictly speaking the same as reachability, and we will need to delve more into the details to obtain undecidability results. 

This section is dedicated to studying reset-VASS for showing undecidability of {\sc Resilience} and {\sc State-resilience} for WSTS in general. 

\subsection{Home-state is undecidable for Minsky machine, reset-VASS and WSTS}\label{HS-Minsk}


We mentionned in Section~$3$ that {\sc Resilience} is undecidable for WSTS in general when $\Safe = \downarrow \Safe$ and $\Bad = \uparrow \Bad$. Let us provide a more detailed undecidability proof here.

First, let us recall the home-state problem

\problemx{Home-state}
{A transition system $\mathscr{S}=(S,\rightarrow)$ and a state $s \in S$.}
{$\post^*(S) \subseteq \pred^*(\{s\})$ ?\newline}

% whether a state $s$ is such that, for all state $s_0$ there exists a path from $s_0$ to $s$.
% post ∗ (S ) ⊆ pred ∗ (s_0)


Home-state is undecidable for Minsky machine with $3+$ counters.
This stems from the fact $2$-counter Minsky machine termination is undecidable~\cite{Min61, Min67}.
From a $2$-counter Minsky machine $M$, one can construct a $3$-counter Minsky machine $M'$ 
such that the Minsky machine $M$ terminates for all inputs iff the Minsky machine $M'$ can reach $(0,0,0)$ from any input with at least $1$ on its third counter. We build $M'$ to simulate $M$ until it reaches a control state indicative of termination, then lower the first two counters until they reach $0$, then, and only then, finally lower the third counter until it reaches $0$.
% Home-state indécidable pour les Minsky machine (preuve très rapide: M à $2$ compteurs s'arrête ssi M' visite $(0,0,0)$ depuis $\uparrow(0,0,1)$, où M' est M mais avec un troisième compteur qui commence à $1$ et qui simule M jusqu'à ce que M s'arrête et à ce moment là décroit les deux premiers compteurs puis le troisième et atteint $(0,0,0)$).
% or les minsky machine peuvent être simulées par les reset petri nets, on réduit le home-state des minsky machine au home-state des reset petri nets, ce qui donne l'indécidabilité du home-state pour les WSTS en général.
Thus {\sc Home-state} is undecidable for Minsky machines. Since $\post^*(S) \subseteq \pred^*(\{s\})$ is equivalent to $S \rightarrow^* \{s\}$,  {\sc Home-state} is a particular instance of {\sc Resilience}. Hence {\sc Resilience} is undecidable for Minsky machines.


Executions of Minsky machines can be simulated by reset-VASS~\cite{araki1976PN}. 
% Let us recall more formally what a reset-VASS is.
Reset-VASS extend the basic VASS model with special “reset
transitions” that resets (set to $0$) some coordinates in the vector. Let us recall their definition here.
\begin{definition}
A {\em reset-VASS} in dimension $d$ %(reset-VASS for short)
 is a finite 
labeled directed graph $V = (Q,T)$, where $Q$ will be referred to as the {\em control-states} of $V$, and where 
$T \subseteq Q \times Op \times Q$
 will be referred to as the {\em control-transitions} of $V$,
where $Op = \{ add(\textbf{z}) \mid \textbf{z} \in \mathds{Z}^d\} \cup 
		\{ reset(i) \mid i \in \{1,\ldots,d\} \}$.
\end{definition}

Again $Q \times \N^d$
 denotes the set of configurations of $V$.
For every configurations $p(\textbf{u}), q(\textbf{v}) \in Q \times \N^d$ and every control-transition $t$ we write
$p(\textbf{u}) \xrightarrow{t} q(\textbf{v})$ when 
\begin{samepage}\begin{itemize}
\item  $t = (q,add(\textbf{z}),q') \in T$
% then for all $\textbf{u} \in \N^d$ such that  
% $\textbf{u}+\textbf{z} \geq 0$
% $q(\textbf{u}) \xrightarrow{\textbf{z}} q'(\textbf{u}+\textbf{z})$,
and $\textbf{u}+\textbf{z} = \textbf{v} \geq 0$,
\item $t = (q,reset(\gamma),q') \in T$ 
% then for all $\textbf{u} \in \N^d$ 
% $q(\textbf{u}) \xrightarrow{z} q'(\textbf{u}')$,  where 
and
$\textbf{v}[\gamma] = 0$, and $\textbf{v}[\gamma'] = \textbf{u}[\gamma']$ for all $\gamma' \in \{1,\ldots, d\} \setminus \gamma$.
\end{itemize} \end{samepage}

It is well known that reset-VASS are WSTS~\cite{dufourd1998reset}. 
Since Reset-VASS can simulate executions of a Minsky machine, {\sc Resilience} is undecidable for reset-VASS and hence for WSTS in general as well.


\subsection{Reset-VASS and state-resilience}\label{appendix}

We are now interested in the 
%following
 undecidable \cite{araki1976PN} decision problem of {\em zero-reachability} in reset-VASS, which consists in, given a
reset-VASS $V=(Q,T)$, and $p(\textbf{u}) \in Q \times \N^d$,
deciding whether $\exists q \in Q ~ p(\textbf{u}) \to^* q(\textbf{0})$.
%
We reduce the zero-reachability problem to the problem of deciding whether a control-transition is live,
which we then reduce to {\sc State-resilience}.
A control-transition $t$ of a reset-VASS is {\em live} in a configuration $r(\textbf{w})$ if for each $q(\textbf{v}) \in \post^*(r(\textbf{w}))$ there exists a 
 $p(\textbf{u})$ with $q(\textbf{v}) \to^* p(\textbf{u})$ such that $t$ is enabled in $p(\textbf{u})$. We say the whole reset-VASS is live if all its control-transitions are
live. This leads to the following problem.

\problemx{$t$-liveness}
{reset-VASS $V=(Q,T)$, $t \in T$, initial configuration $s_0$}
{Is $t$ live in $s_0$ ? \\}


To better discuss $t$-liveness let us define more formally the upward-closed set of configurations such that $t$ is enabled
$pre(t)=\{ p(\textbf{u}) \in S \mid \exists q(\textbf{v})$ such that $ p(\textbf{u}) \xrightarrow{t} q(\textbf{v}) \}$.



\begin{proposition}\label{reductions}
{\sc $t$-liveness} is reducible to {\sc State-resilience} in reset-VASS.
\end{proposition}


\begin{proof}
We reformulate $t$-liveness 
in a 
% WSTS $\mathscr{S}=(S,\rightarrow, \leq)$ with an initial state $s_0$ 
reset-VASS $(Q,T)$ 
with initial configuration $s_0$
as the following formula
\[ ~ \forall p(\textbf{u}) \in Q \times \N^d, 
~ s_0 \rightarrow^* p(\textbf{u}) \implies \exists q(\textbf{v}) \in pre(t), ~ p(\textbf{u}) \rightarrow^{*} q(\textbf{v})\]  
The problem reduces itself to {\sc State-resilience}
where $\Safe = pre(t)$.
\end{proof}


The following theorem is a transposition of Theorem~5.5 from \cite{peterson1981petri} from Petri nets to reset-VASS%, whose proof can be seen in Appendix~\ref{appendix}%
.
\begin{proposition}\label{liveness reset}
The  zero reachability problem can be reduced to the $t$-liveness problem in reset-VASS.
\end{proposition}

% \section{Proof of Theorem~\ref{liveness reset}}\label{appendix}

% Recall Theorem~\ref{liveness reset}.


%\begin{proposition}\label{liveness reset}
% The  zero reachability problem can be reduced to the $t$-liveness problem in reset-VASS.
%\end{proposition}

Let us describe therein how to adjust Theorem~5.5 from \cite{peterson1981petri}.

\begin{proof}

\mathieu{Thinking about using reset-VAS to simplify notations.}

We wish to determine if $q(\textbf{0})$ is reachable in a reset-VASS $V_1$
with
initial vector $\textbf{u}$ and initial state $q$.
To do so, we construct a reset-VASS $V_2$
with initial vector $\textbf{v}$ and initial state $q'$
which is live if and only if 
$\textbf{0}$
is reachable from $\textbf{u}$.

The new reset-VASS is constructed by adding four new vector coordinate
and
$|V_1|+4$ new transitions.

We first modify all transitions to include a $-1$ on the first additional vector coordinate and a $+1$ on the second additional vector coordinate. We also add a transition with only $+1$ on the first additional vector coordinate and $-1$ on the second one.

% The reset PN $C_2$ is constructed from $C_1$ by the addition of two places $r_1$ and $r_2$ and $|P_1| +2$ transitions $s$, $\{ s_p | p \in P_1 \}$ and $s'$.

% We first modify all transitions of $T_1$ to include $r_1$ as both an input and an output.

The initial vector $\textbf{v}$ is constructed from $\textbf{u}$ by having at least $1$ on the first two additional vector coordinate.


% The initial marking $\mu_2$ will include a token in $r_1$. 

These two vector coordinate serve to mark that the run is ongoing. As long as they are both non-zero, the adjusted transitions of $V_1$ are live and can be used normally. Thus any vector which is reachable in $V_1$ is also reachable [in $V_2$].

% The place $r_1$ is a 'run' place; as long as the token remains in $r_1$ the transitions of $T_1$ can fire normally.
% Thus any marking which is reachable in the places of $P_1$ is also reachable in $C_2$.


We add an additional transition $s$ which reset the first two additional vector coordinate.
% Transition $s$ is defined to have $r_1$ as an input and a null output.
This allows to disable the transitions of $V_1$ and to "freeze" the vector of $V_1$.
% This allows the token in $r_1$ to be removed, disabling all transitions in $T_1$ and "freezing" the marking of $P_1$.

% Note that all transitions of $T_1$ are in conflict and, by construction if not by definition, no more than one transition can fire at a time.

These first two additional vector coordinate together with this additional transition allow
to reach aby reachable vector and then to freeze.

% The place $r_1$ and transition $s$ allow the net $C_1$ to reach any reachable marking and then for $s$ to fire and freeze the net at that marking.

Now we need to see if that vector is zero.
% Now we need to see if that marking is zero.

We introduce two new additional vector coordinate and $d$ new transitions which have
$-1$ on the $d$-th vector coordinate and $+1$ on this penultimate coordinate. 

% We introduce a new place $r_2$ and new transitions $s_p$ which have $p$ as input and $r_2$ as output.

If $\textbf{0}$ is reachable, then these $d$ new transitions are not live. Everything is dead if $s$ fires in $\textbf{0}$.

% If $p$ can ever become zero, $s_p$ is not live. The entire net is dead if $s$ fires in the marking zero.

If we can always have some vector coordinate be not zero, then we can always fire some transition to add $+1$ to the penultimate additional coordinate.
% If we can always have some $p_i$ not be zero, then we can always fire some $s_{p_i}$, putting a token in $r_2$.
In this case we can add to the first additional coordinate again and assure that all transitions are live.
% In this case we must put a token back in $r_1$ and assure that all transitions in $C_2$ are live.
We must be sure that $V_2$ is live even if $V_1$ is {\em not} live.
% We must be sure that $C_2$ is live even if $C_1$ is {\em not} live.
% This is accomplished by a transition $s'$ which  "floods" the net $C_2$ with tokens, assuring that every transition is live if a token is ever put in $r_2$. Transition $s'$ has $r_2$ as its input and every place of $C_2$ as output
This is accomplished by a transition $s'$ which arbitrarily increments every other vector coordinate 
while decrementing the penultimate one and, additionally, a transition which 
substract from the last additional vector coordinate and add to the penultimate one. 


Now if $\textbf{0}$ is reachable from $\textbf{u}$ in $V_1$, then $V_2$ can also reach a similar
vector $(0,0,0,\ldots, 0, 1,0,0,0)$ by executing the same sequence of transition.
Then $s$ can freeze the $V_1$ subset,
% Now if $0$ is reachable in $R(C_1, \mu_1)$  then the net $C_2$ can also reach this marking in the place of $P_1$ by executing the same sequence of transition firings. Then $s$ can fire, freezing the $C_1$ subset.
ending up in $0^{d+4}$, and $V_2$ is not live.
% Since $mu(p_i) = 0$ for all $p_i \in P_1$, no transition $s_{p_i}$ with $p_i \in P_1$ can fire, and $C_2$ is dead.
Thus if $\textbf{0}$ is reachable then $V_2$ is not live.


Conversely, if $V_2$ is not live, then a vector is reachable in which the last two coordinate are equal to $0$ and there is no reachable vector in which either is equal to at least one.
% Conversely, if $C_2$ is not live, then a marking $\mu$ must be reachable in which  $\mu(r_2) = 0$ and there is no reachable state in which $r_2$ has a token (in particular, since we do not allow token removal from $r_2$, the marking $\mu$ must be reached in a sequence of transitions that do not place any token in $r_2$.).
If it is not possible to have (), then the transitions are not live, and the
$d$-dimensional subset of the current vector must be zero.
% If $r_2$ has no token and cannot get any, then the transitions $s_p$ are not live, and the markings of $p$ for $p \in P_1$ must be zero. 
% Thus if $C_2$ is not live then a marking is reachable in which the marking of each $p$ in $P_1$ is zero. 
Thus if $V_2$ is not live then 
$\textbf{0}$ is reachable.
\end{proof}


Since the zero-reachability problem for reset-VASS is undecidable, the reduction implies 
% the following:
%
%
{\sc %$ reset-VASS 
$t$-liveness} is undecidable.

Since {\sc $t$-liveness} is undecidable, from Proposition~\ref{reductions},  we deduce that {\sc State-resilience} is undecidable  for reset-VASS, which are WSTS with strong compatibility. Hence {\sc State-resilience} is undecidable  for WSTS with strong upward-compatibility. %This undecidability result furthermore implies the undecidability of the other two state resilience problems by straightforward reductions.








