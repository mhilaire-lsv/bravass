

\section{Case: $\Bad=\downarrow \Bad$ and $\Safe=\downarrow \Safe$}\label{case down down}

The well-known mutual exclusion property can be modelized, in a $d$-VASS with $k$ counters, by the property that a special counter $c_{mutex}$ must be bounded by $k \geq 1$ which counts the number of processes that are allowed to be simultaneously in the critical section. Then, the set $\Safe =  \{c_{mutex} \leq k\} \times \mathbb{N}^{d-1}$ is downward-closed.
%		and $\Bad =\{c_{mutex} \geq k+1\} \times  \mathbb{N}^{d-1} $ is the upward-closed complementary of $\Safe$. 

% In the case \Safe and \Bad are both downward-closed, they can both be finite.

\begin{theorem}\label{down-down}
The resilience problem is undecidable for  effective WSTS with  strong  compatibility such that
%	with more than one minimal element, 
$\Safe=\downarrow \Safe$
and $\Bad=\downarrow \Bad$.
\end{theorem}

\begin{proof}
If the set $S$ of a WSTS $\mathscr{S}=(S,\rightarrow, \leq)$ has an unique minimal element $m$, then $m$ belongs to both $\Safe$ and $\Bad$ which contradicts the assumption $\Safe \cap \Bad= \emptyset$. So let us consider the case of a set $S$ with at least two minimal elements $m_1$ and $m_2$.
The problem of whether $m_2$ is reachable from $m_1$ reduces itself to the resilience problem by considering $\Safe=\downarrow m_2 = \{ m_2\}$ and $\Bad=\downarrow m_1 = \{ m_1\}$. By undecidability of the reachability problem for effective WSTS with strong compatibility we conclude.  
\end{proof}


\section{Case: $\Bad=\uparrow \Bad$ and $\Safe=\uparrow \Safe$.}\label{case up up}


% \alain{2 clos par le haut ont une intersection non vide....}

Since $\Bad \cap \Safe = \emptyset$, the subcase $\Safe = \uparrow \Safe$ and $\Bad = \uparrow \Bad$ leads to a contradiction since two upward-closed sets have not an empty intersection. We then consider the case where $\Bad$ is as upward-closed
as it can be without intersecting with $\Safe$,
i.e. 
such that there exists an upward-closed set $U$
such that $\Bad = U \setminus \Safe$.

\iffalse
\alain{à quoi ça sert ici ?: quelle signification ?Decidability of $U$ and $\Safe$ imply the decidability of $\Bad$.}
\mathieu{Pas convaincu que ça serve, je vais enlever}
% hop
\fi

example: ?


\begin{theorem}\label{up-up}
The resilience problem is decidable for effective WSTS with effective pred-basis, $\Safe=\uparrow \Safe$
and $\Bad= U \setminus \Safe$ with $U = \uparrow U$.
\end{theorem}


\begin{proof}
Since $\Safe=\uparrow \Safe$ is upward-closed, there exists a finite basis $B_{ \Safe}$ such that $\uparrow \Safe = \uparrow B_{\Safe}$. 
Moreover since $\mathscr{S}=(S,\rightarrow,\leq)$ is a WSTS,  $\pred^*(\Safe)=\uparrow \pred^*(\Safe)$ and $\pred^*(\Safe)$ admits a finite basis $B_{\pred^*(\Safe)}$. Since $\mathscr{S}=(S,\rightarrow,\leq)$ is a WSTS  with effective pred-basis, we may compute a finite basis of $\pred^*(\Safe)$ with the backward coverability algorithm. 
Since $U$  is upward-closed, there exists a finite basis $B_{U}$ such that $U = \uparrow B_{U}$. % Moreover $ \uparrow B_{\Bad} \subseteq \uparrow B_{\pred^*(\Safe)}$ iff for every $b \in B_{\Bad}$, there is a $s \in B_{\pred^*(\Safe)}$ such that $s \leq b$.
Since $\Bad = U \setminus \Safe$, $\Bad \subseteq \uparrow B_{\pred^*(\Safe)}$ iff for every $b \in B_{U}$, there is either $s \in B_{\pred^*(\Safe)}$ such that $s \leq b$, either $t \in B_{\Safe}$ such that $t\leq b$,
% si on est dans up Bad, il faut que ou bien on soit dans pred(Safe) ou bien on soit dans Safe
hence the resilience problem is decidable.
\end{proof}

\begin{proposition}
In WSTS with strong compatibility and effective pred-basis,  $\Safe=\uparrow \Safe$, the bounded resilience problem is equivalent to the resilience problem.
\end{proposition}

\begin{proof}
Since $\Safe=\uparrow \Safe$ and
$\mathscr{S}=(S,\rightarrow,\leq)$ is a WSTS with strong %upward-
compatibility, then $\pred^{\leq n}(\Safe)= \uparrow~\pred^{\leq n}(\Safe)$ for all $n \in \N$,
% \alain{$\pred^n$ ou $\pred^{\leq n}$ ? même question pour post. et où est-ce défini ?}
and there exists $n_0 \in \N$ such that 
$\pred^{\leq n_0}(\Safe) = \uparrow \pred^{\leq n_0}(\Safe) = \uparrow \pred^*(\Safe) = \pred^*(\Safe)$.
Hence the equivalence.
\end{proof}

\begin{corollary}\label{B-up-up}
The bounded resilience problem is decidable for WSTS with effective pred-basis,
strong compatibility
 $\Safe=\uparrow \Safe$
and $\Bad=U \setminus \Safe$ with $U = \uparrow U$.
\end{corollary}


\begin{theorem}\label{k-up-up}
The % three %uniform 
$k$-resilience problem is decidable for WSTS with effective pred-basis, strong %upward-
compatibility, $\Safe=\uparrow \Safe$
and $\Bad=U \setminus \Safe$  with $U = \uparrow U$.
%	and \Bad is upward-closed or downward-closed.
\end{theorem}

\begin{proof}
Since $\Safe=\uparrow \Safe$ is upward-closed, there exists a finite basis $B_{ \Safe}$ such that $\uparrow \Safe = \uparrow B_{\Safe}$. 
Moreover since $\mathscr{S}=(S,\rightarrow,\leq)$ is a WSTS with strong (upward) compatibility,  $\pred^{\leq n}(\Safe)=\uparrow \pred^{\leq n}(\Safe)$ for all $n\in \N$ and $\pred^{\leq k}(\Safe)$ admits a finite basis $B_{\pred^{\leq k}(\Safe)}$. % Since $\mathscr{S}=(S,\rightarrow,\leq)$ is a WSTS  with effective pred-basis, we may compute a finite basis of $\pred^{\leq k}(\Safe)$ with the backward coverability algorithm. 
Since $U$  is upward-closed, there exists a finite basis $B_{U}$ such that $U = \uparrow B_{U}$. % Moreover $ \uparrow B_{\Bad} \subseteq \uparrow B_{\pred^{\leq k}(\Safe)}$ iff for every $b \in B_{\Bad}$, there is a $s \in B_{\pred^*(\Safe)}$ such that $s \leq b$.
Since $\Bad = U \setminus \Safe$, $\Bad \subseteq \uparrow B_{\pred^{\leq k}(\Safe)}$ iff for every $b \in B_{U}$, there is either $s \in B_{\pred^{\leq k}(\Safe)}$ such that $s \leq b$, either $t \in B_{\Safe}$ such that $t\leq b$,
% si on est dans up Bad, il faut que ou bien on soit dans pred(Safe) ou bien on soit dans Safe
hence the resilience problem is decidable.
\end{proof}







\section{Proof of Theorem~\ref{liveness reset}}\label{appendix}

Recall Theorem~\ref{liveness reset}.

\mathieu{À refaire avec des Reset VASS}

\begin{theorem*}[Adjusting Theorem~5.5 from \cite{peterson1981petri}]
The  Reset Petri Net zero reachability problem can be reduced to the liveness problem.
\end{theorem*}

Let us describe therein how to adjust Theorem~5.5 from \cite{peterson1981petri}.

\begin{proof}
If we wish to determine if $0 \in R(C_1, \mu_1)$ in any
reset Petri net $C_1 = (P_1, T_1, I_1, O_1, R_1 )$ (where $R_1(t) =$ places that are reset when t fires off), with initial marking $\mu_1$, we construct a
reset petri net $C_2 = (P_2, T_2, I_2, O_2, R_2 )$ with initial marking
$\mu_2$ which is live if and only if the zero marking is not reachable from $\mu_1$.

The reset PN $C_2$ is constructed from $C_1$ by the addition of two places $r_1$ and $r_2$
and $|P_1| +2$ transitions $s$, $\{ s_p | p \in P_1 \}$ and $s'$.

We first modify all transitions of $T_1$ to include $r_1$ as both an input and an output.
The initial marking $\mu_2$ will include a token in $r_1$. 


The place $r_1$ is a 'run' place; as long as the token remains in $r_1$ the transitions of $T_1$ can fire normally.
Thus any marking which is reachable in the places of $P_1$ is also reachable in $C_2$.



Transition $s$ is defined to have $r_1$ as an input and a null output.
This allows the token in $r_1$ to be removed, disabling all transitions in $T_1$
and "freezing" the marking of $P_1$.

Note that all transitions of $T_1$ are in conflict and, by construction if not by definition, no more than one transition can fire at a time.

The place $r_1$ and transition $s$ allow the net $C_1$ to reach any reachable marking and then for $s$ to fire and freeze the net at that marking.

Now we need to see if that marking is zero.

We introduce a new place $r_2$ and new transitions $s_p$ which have $p$ as input and $r_2$ as output.

If $p$ can ever become zero, $s_p$ is not live. The entire net is dead if
$s$ fires in the marking zero.

If we can always have some $p_i$ not be zero, then we can always fire some $s_{p_i}$, putting a token in $r_2$.

In this case we must put a token back in $r_1$ and assure that all transitions in $C_2$ are live.
We must be sure that $C_2$ is live even if $C_1$ is {\em not} live.
This is accomplished by a transition $s'$ which  "floods" the net $C_2$ with tokens, assuring that every transition is live if a token is ever put in $r_2$.
Transition $s'$ has $r_2$ as its input and every place of $C_2$ as output

Now if $0$ is reachable
in $R(C_1, \mu_1)$ 
then the net $C_2$ can also reach this marking
in the place of $P_1$ by executing the same sequence of transition firings.
Then $s$ can fire, freezing the $C_1$ subset.
Since $mu(p_i) = 0$ for all $p_i \in P_1$, no transition $s_{p_i}$ with $p_i \in P_1$ can fire, and $C_2$ is dead.
Thus if $0$ is reachable then $C_2$ is not live.

Conversey, if $C_2$ is not live, then a marking $\mu$ must be reachable in which 
$\mu(r_2) = 0$ and there is no reachable state in which $r_2$ has a token
(in particular, since we do not allow token removal from $r_2$, the marking $\mu$ must be reached in a sequence of transitions that do not place any token in $r_2$.)
% (Rappel: tant que il y a un token quelque part, on peut mettre un token en r_2
% et r_2 commence sans token)
If $r_2$ has no token and cannot get any, then the transitions $s_p$ are not live, and the markings of $p$ for $p \in P_1$ must be zero. 
Thus if $C_2$ is not live then a marking is reachable in which the marking of each $p$ in $P_1$ is zero. 

\end{proof}


\section{More Appendix thing if necessary}\label{appendix B}
